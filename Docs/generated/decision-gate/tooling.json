[
  {
    "description": "Register a ScenarioSpec, validate it, and return the canonical hash used for integrity checks.",
    "examples": [
      {
        "description": "Register the example scenario spec.",
        "input": {
          "spec": {
            "default_tenant_id": null,
            "namespace_id": 1,
            "policies": [],
            "predicates": [
              {
                "comparator": "equals",
                "expected": "production",
                "policy_tags": [],
                "predicate": "env_is_prod",
                "query": {
                  "params": {
                    "key": "DEPLOY_ENV"
                  },
                  "predicate": "get",
                  "provider_id": "env"
                }
              },
              {
                "comparator": "equals",
                "expected": true,
                "policy_tags": [],
                "predicate": "after_freeze",
                "query": {
                  "params": {
                    "timestamp": 1710000000000
                  },
                  "predicate": "after",
                  "provider_id": "time"
                }
              }
            ],
            "scenario_id": "example-scenario",
            "schemas": [],
            "spec_version": "v1",
            "stages": [
              {
                "advance_to": {
                  "kind": "terminal"
                },
                "entry_packets": [
                  {
                    "content_type": "application/json",
                    "expiry": null,
                    "packet_id": "packet-hello",
                    "payload": {
                      "kind": "json",
                      "value": {
                        "message": "hello",
                        "purpose": "scenario entry packet"
                      }
                    },
                    "policy_tags": [],
                    "schema_id": "schema-hello",
                    "visibility_labels": [
                      "public"
                    ]
                  }
                ],
                "gates": [
                  {
                    "gate_id": "env_gate",
                    "requirement": {
                      "Predicate": "env_is_prod"
                    }
                  },
                  {
                    "gate_id": "time_gate",
                    "requirement": {
                      "Predicate": "after_freeze"
                    }
                  }
                ],
                "on_timeout": "fail",
                "stage_id": "main",
                "timeout": null
              }
            ]
          }
        },
        "output": {
          "scenario_id": "example-scenario",
          "spec_hash": {
            "algorithm": "sha256",
            "value": "5c3a5b6bce0f4a2c9e22c4fa6a1e6d8d90b0f2dfed1b7f1e9b3d3b3d1f0c9b21"
          }
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "spec": {
          "$ref": "decision-gate://contract/schemas/scenario.schema.json",
          "description": "Scenario specification to register."
        }
      },
      "required": [
        "spec"
      ],
      "type": "object"
    },
    "name": "scenario_define",
    "notes": [
      "Use before starting runs; scenario_id becomes the stable handle for later calls.",
      "Validates stage/gate/predicate IDs, RET trees, and predicate references.",
      "Spec hash is deterministic; store it for audit and runpack integrity.",
      "Fails closed on invalid specs or duplicate scenario IDs."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "scenario_id": {
          "description": "Scenario identifier.",
          "type": "string"
        },
        "spec_hash": {
          "additionalProperties": false,
          "properties": {
            "algorithm": {
              "enum": [
                "sha256"
              ],
              "type": "string"
            },
            "value": {
              "description": "Lowercase hex digest.",
              "type": "string"
            }
          },
          "required": [
            "algorithm",
            "value"
          ],
          "type": "object"
        }
      },
      "required": [
        "scenario_id",
        "spec_hash"
      ],
      "type": "object"
    }
  },
  {
    "description": "Create a new run state for a scenario and optionally emit entry packets.",
    "examples": [
      {
        "description": "Start a run for the example scenario and issue entry packets.",
        "input": {
          "issue_entry_packets": true,
          "run_config": {
            "dispatch_targets": [
              {
                "agent_id": "agent-alpha",
                "kind": "agent"
              }
            ],
            "namespace_id": 1,
            "policy_tags": [],
            "run_id": "run-0001",
            "scenario_id": "example-scenario",
            "tenant_id": 1
          },
          "scenario_id": "example-scenario",
          "started_at": {
            "kind": "unix_millis",
            "value": 1710000000000
          }
        },
        "output": {
          "current_stage_id": "main",
          "decisions": [],
          "dispatch_targets": [
            {
              "agent_id": "agent-alpha",
              "kind": "agent"
            }
          ],
          "gate_evals": [],
          "namespace_id": 1,
          "packets": [],
          "run_id": "run-0001",
          "scenario_id": "example-scenario",
          "spec_hash": {
            "algorithm": "sha256",
            "value": "5c3a5b6bce0f4a2c9e22c4fa6a1e6d8d90b0f2dfed1b7f1e9b3d3b3d1f0c9b21"
          },
          "stage_entered_at": {
            "kind": "unix_millis",
            "value": 1710000000000
          },
          "status": "active",
          "submissions": [],
          "tenant_id": 1,
          "tool_calls": [],
          "triggers": []
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "issue_entry_packets": {
          "description": "Issue entry packets immediately.",
          "type": "boolean"
        },
        "run_config": {
          "additionalProperties": false,
          "description": "Run configuration and dispatch targets.",
          "properties": {
            "dispatch_targets": {
              "items": {
                "oneOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "agent_id": {
                        "description": "Agent identifier.",
                        "type": "string"
                      },
                      "kind": {
                        "const": "agent"
                      }
                    },
                    "required": [
                      "kind",
                      "agent_id"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "session"
                      },
                      "session_id": {
                        "description": "Session identifier.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "kind",
                      "session_id"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "external"
                      },
                      "system": {
                        "description": "External system name.",
                        "type": "string"
                      },
                      "target": {
                        "description": "External system target.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "kind",
                      "system",
                      "target"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "channel": {
                        "description": "Broadcast channel identifier.",
                        "type": "string"
                      },
                      "kind": {
                        "const": "channel"
                      }
                    },
                    "required": [
                      "kind",
                      "channel"
                    ],
                    "type": "object"
                  }
                ]
              },
              "type": "array"
            },
            "namespace_id": {
              "description": "Namespace identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "policy_tags": {
              "description": "Policy tags applied to the run.",
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "run_id": {
              "description": "Run identifier.",
              "type": "string"
            },
            "scenario_id": {
              "description": "Scenario identifier.",
              "type": "string"
            },
            "tenant_id": {
              "description": "Tenant identifier.",
              "minimum": 1,
              "type": "integer"
            }
          },
          "required": [
            "tenant_id",
            "run_id",
            "scenario_id",
            "dispatch_targets",
            "policy_tags"
          ],
          "type": "object"
        },
        "scenario_id": {
          "description": "Scenario identifier.",
          "type": "string"
        },
        "started_at": {
          "description": "Caller-supplied run start timestamp.",
          "oneOf": [
            {
              "additionalProperties": false,
              "properties": {
                "kind": {
                  "const": "unix_millis"
                },
                "value": {
                  "type": "integer"
                }
              },
              "required": [
                "kind",
                "value"
              ],
              "type": "object"
            },
            {
              "additionalProperties": false,
              "properties": {
                "kind": {
                  "const": "logical"
                },
                "value": {
                  "minimum": 0,
                  "type": "integer"
                }
              },
              "required": [
                "kind",
                "value"
              ],
              "type": "object"
            }
          ]
        }
      },
      "required": [
        "scenario_id",
        "run_config",
        "started_at",
        "issue_entry_packets"
      ],
      "type": "object"
    },
    "name": "scenario_start",
    "notes": [
      "Requires RunConfig (tenant_id, run_id, scenario_id, dispatch_targets).",
      "Use started_at to record the caller-supplied start timestamp.",
      "If issue_entry_packets is true, entry packets are disclosed immediately.",
      "Fails closed if run_id already exists or scenario_id is unknown."
    ],
    "output_schema": {
      "additionalProperties": false,
      "properties": {
        "current_stage_id": {
          "description": "Current stage identifier.",
          "type": "string"
        },
        "decisions": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "correlation_id": {
                "oneOf": [
                  {
                    "type": "null"
                  },
                  {
                    "description": "Correlation identifier.",
                    "type": "string"
                  }
                ]
              },
              "decided_at": {
                "oneOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "unix_millis"
                      },
                      "value": {
                        "type": "integer"
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "logical"
                      },
                      "value": {
                        "minimum": 0,
                        "type": "integer"
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  }
                ]
              },
              "decision_id": {
                "description": "Decision identifier.",
                "type": "string"
              },
              "outcome": {
                "oneOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "start"
                      },
                      "stage_id": {
                        "description": "Initial stage identifier.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "kind",
                      "stage_id"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "complete"
                      },
                      "stage_id": {
                        "description": "Terminal stage identifier.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "kind",
                      "stage_id"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "from_stage": {
                        "description": "Previous stage identifier.",
                        "type": "string"
                      },
                      "kind": {
                        "const": "advance"
                      },
                      "timeout": {
                        "type": "boolean"
                      },
                      "to_stage": {
                        "description": "Next stage identifier.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "kind",
                      "from_stage",
                      "to_stage",
                      "timeout"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "hold"
                      },
                      "summary": {
                        "additionalProperties": false,
                        "properties": {
                          "policy_tags": {
                            "description": "Policy tags applied to the summary.",
                            "items": {
                              "type": "string"
                            },
                            "type": "array"
                          },
                          "retry_hint": {
                            "oneOf": [
                              {
                                "type": "null"
                              },
                              {
                                "description": "Optional retry hint.",
                                "type": "string"
                              }
                            ]
                          },
                          "status": {
                            "description": "Summary status.",
                            "type": "string"
                          },
                          "unmet_gates": {
                            "items": {
                              "description": "Gate identifier.",
                              "type": "string"
                            },
                            "type": "array"
                          }
                        },
                        "required": [
                          "status",
                          "unmet_gates",
                          "retry_hint",
                          "policy_tags"
                        ],
                        "type": "object"
                      }
                    },
                    "required": [
                      "kind",
                      "summary"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "fail"
                      },
                      "reason": {
                        "description": "Failure reason.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "kind",
                      "reason"
                    ],
                    "type": "object"
                  }
                ]
              },
              "seq": {
                "minimum": 0,
                "type": "integer"
              },
              "stage_id": {
                "description": "Stage identifier.",
                "type": "string"
              },
              "trigger_id": {
                "description": "Trigger identifier.",
                "type": "string"
              }
            },
            "required": [
              "decision_id",
              "seq",
              "trigger_id",
              "stage_id",
              "decided_at",
              "outcome",
              "correlation_id"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "dispatch_targets": {
          "items": {
            "oneOf": [
              {
                "additionalProperties": false,
                "properties": {
                  "agent_id": {
                    "description": "Agent identifier.",
                    "type": "string"
                  },
                  "kind": {
                    "const": "agent"
                  }
                },
                "required": [
                  "kind",
                  "agent_id"
                ],
                "type": "object"
              },
              {
                "additionalProperties": false,
                "properties": {
                  "kind": {
                    "const": "session"
                  },
                  "session_id": {
                    "description": "Session identifier.",
                    "type": "string"
                  }
                },
                "required": [
                  "kind",
                  "session_id"
                ],
                "type": "object"
              },
              {
                "additionalProperties": false,
                "properties": {
                  "kind": {
                    "const": "external"
                  },
                  "system": {
                    "description": "External system name.",
                    "type": "string"
                  },
                  "target": {
                    "description": "External system target.",
                    "type": "string"
                  }
                },
                "required": [
                  "kind",
                  "system",
                  "target"
                ],
                "type": "object"
              },
              {
                "additionalProperties": false,
                "properties": {
                  "channel": {
                    "description": "Broadcast channel identifier.",
                    "type": "string"
                  },
                  "kind": {
                    "const": "channel"
                  }
                },
                "required": [
                  "kind",
                  "channel"
                ],
                "type": "object"
              }
            ]
          },
          "type": "array"
        },
        "gate_evals": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "evaluation": {
                "additionalProperties": false,
                "properties": {
                  "gate_id": {
                    "description": "Gate identifier.",
                    "type": "string"
                  },
                  "status": {
                    "description": "Tri-state evaluation result.",
                    "enum": [
                      "True",
                      "False",
                      "Unknown"
                    ],
                    "type": "string"
                  },
                  "trace": {
                    "items": {
                      "additionalProperties": false,
                      "properties": {
                        "predicate": {
                          "description": "Predicate identifier.",
                          "type": "string"
                        },
                        "status": {
                          "description": "Tri-state evaluation result.",
                          "enum": [
                            "True",
                            "False",
                            "Unknown"
                          ],
                          "type": "string"
                        }
                      },
                      "required": [
                        "predicate",
                        "status"
                      ],
                      "type": "object"
                    },
                    "type": "array"
                  }
                },
                "required": [
                  "gate_id",
                  "status",
                  "trace"
                ],
                "type": "object"
              },
              "evidence": {
                "items": {
                  "additionalProperties": false,
                  "properties": {
                    "predicate": {
                      "description": "Predicate identifier.",
                      "type": "string"
                    },
                    "result": {
                      "additionalProperties": false,
                      "properties": {
                        "content_type": {
                          "oneOf": [
                            {
                              "type": "null"
                            },
                            {
                              "description": "Evidence content type.",
                              "type": "string"
                            }
                          ]
                        },
                        "error": {
                          "oneOf": [
                            {
                              "type": "null"
                            },
                            {
                              "additionalProperties": false,
                              "properties": {
                                "code": {
                                  "description": "Stable error code.",
                                  "type": "string"
                                },
                                "details": {
                                  "oneOf": [
                                    {
                                      "type": "null"
                                    },
                                    {
                                      "description": "Optional structured error details.",
                                      "type": [
                                        "null",
                                        "boolean",
                                        "number",
                                        "string",
                                        "array",
                                        "object"
                                      ]
                                    }
                                  ]
                                },
                                "message": {
                                  "description": "Error message.",
                                  "type": "string"
                                }
                              },
                              "required": [
                                "code",
                                "message",
                                "details"
                              ],
                              "type": "object"
                            }
                          ]
                        },
                        "evidence_anchor": {
                          "oneOf": [
                            {
                              "type": "null"
                            },
                            {
                              "additionalProperties": false,
                              "properties": {
                                "anchor_type": {
                                  "description": "Anchor type identifier.",
                                  "type": "string"
                                },
                                "anchor_value": {
                                  "description": "Anchor value.",
                                  "type": "string"
                                }
                              },
                              "required": [
                                "anchor_type",
                                "anchor_value"
                              ],
                              "type": "object"
                            }
                          ]
                        },
                        "evidence_hash": {
                          "oneOf": [
                            {
                              "type": "null"
                            },
                            {
                              "additionalProperties": false,
                              "properties": {
                                "algorithm": {
                                  "enum": [
                                    "sha256"
                                  ],
                                  "type": "string"
                                },
                                "value": {
                                  "description": "Lowercase hex digest.",
                                  "type": "string"
                                }
                              },
                              "required": [
                                "algorithm",
                                "value"
                              ],
                              "type": "object"
                            }
                          ]
                        },
                        "evidence_ref": {
                          "oneOf": [
                            {
                              "type": "null"
                            },
                            {
                              "additionalProperties": false,
                              "properties": {
                                "uri": {
                                  "description": "Evidence reference URI.",
                                  "type": "string"
                                }
                              },
                              "required": [
                                "uri"
                              ],
                              "type": "object"
                            }
                          ]
                        },
                        "lane": {
                          "description": "Trust lane classification for evidence.",
                          "enum": [
                            "verified",
                            "asserted"
                          ],
                          "type": "string"
                        },
                        "signature": {
                          "oneOf": [
                            {
                              "type": "null"
                            },
                            {
                              "additionalProperties": false,
                              "properties": {
                                "key_id": {
                                  "description": "Signing key identifier.",
                                  "type": "string"
                                },
                                "scheme": {
                                  "description": "Signature scheme identifier.",
                                  "type": "string"
                                },
                                "signature": {
                                  "items": {
                                    "maximum": 255,
                                    "minimum": 0,
                                    "type": "integer"
                                  },
                                  "type": "array"
                                }
                              },
                              "required": [
                                "scheme",
                                "key_id",
                                "signature"
                              ],
                              "type": "object"
                            }
                          ]
                        },
                        "value": {
                          "oneOf": [
                            {
                              "type": "null"
                            },
                            {
                              "oneOf": [
                                {
                                  "additionalProperties": false,
                                  "properties": {
                                    "kind": {
                                      "const": "json"
                                    },
                                    "value": {
                                      "description": "Evidence JSON value.",
                                      "type": [
                                        "null",
                                        "boolean",
                                        "number",
                                        "string",
                                        "array",
                                        "object"
                                      ]
                                    }
                                  },
                                  "required": [
                                    "kind",
                                    "value"
                                  ],
                                  "type": "object"
                                },
                                {
                                  "additionalProperties": false,
                                  "properties": {
                                    "kind": {
                                      "const": "bytes"
                                    },
                                    "value": {
                                      "items": {
                                        "maximum": 255,
                                        "minimum": 0,
                                        "type": "integer"
                                      },
                                      "type": "array"
                                    }
                                  },
                                  "required": [
                                    "kind",
                                    "value"
                                  ],
                                  "type": "object"
                                }
                              ]
                            }
                          ]
                        }
                      },
                      "required": [
                        "value",
                        "lane",
                        "error",
                        "evidence_hash",
                        "evidence_ref",
                        "evidence_anchor",
                        "signature",
                        "content_type"
                      ],
                      "type": "object"
                    },
                    "status": {
                      "description": "Tri-state evaluation result.",
                      "enum": [
                        "True",
                        "False",
                        "Unknown"
                      ],
                      "type": "string"
                    }
                  },
                  "required": [
                    "predicate",
                    "status",
                    "result"
                  ],
                  "type": "object"
                },
                "type": "array"
              },
              "stage_id": {
                "description": "Stage identifier.",
                "type": "string"
              },
              "trigger_id": {
                "description": "Trigger identifier.",
                "type": "string"
              }
            },
            "required": [
              "trigger_id",
              "stage_id",
              "evaluation",
              "evidence"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "namespace_id": {
          "description": "Namespace identifier.",
          "minimum": 1,
          "type": "integer"
        },
        "packets": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "decision_id": {
                "description": "Decision identifier.",
                "type": "string"
              },
              "envelope": {
                "additionalProperties": false,
                "properties": {
                  "content_hash": {
                    "additionalProperties": false,
                    "properties": {
                      "algorithm": {
                        "enum": [
                          "sha256"
                        ],
                        "type": "string"
                      },
                      "value": {
                        "description": "Lowercase hex digest.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "algorithm",
                      "value"
                    ],
                    "type": "object"
                  },
                  "content_type": {
                    "description": "Packet content type.",
                    "type": "string"
                  },
                  "correlation_id": {
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "description": "Correlation identifier.",
                        "type": "string"
                      }
                    ]
                  },
                  "expiry": {
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "oneOf": [
                          {
                            "additionalProperties": false,
                            "properties": {
                              "kind": {
                                "const": "unix_millis"
                              },
                              "value": {
                                "type": "integer"
                              }
                            },
                            "required": [
                              "kind",
                              "value"
                            ],
                            "type": "object"
                          },
                          {
                            "additionalProperties": false,
                            "properties": {
                              "kind": {
                                "const": "logical"
                              },
                              "value": {
                                "minimum": 0,
                                "type": "integer"
                              }
                            },
                            "required": [
                              "kind",
                              "value"
                            ],
                            "type": "object"
                          }
                        ]
                      }
                    ]
                  },
                  "issued_at": {
                    "oneOf": [
                      {
                        "additionalProperties": false,
                        "properties": {
                          "kind": {
                            "const": "unix_millis"
                          },
                          "value": {
                            "type": "integer"
                          }
                        },
                        "required": [
                          "kind",
                          "value"
                        ],
                        "type": "object"
                      },
                      {
                        "additionalProperties": false,
                        "properties": {
                          "kind": {
                            "const": "logical"
                          },
                          "value": {
                            "minimum": 0,
                            "type": "integer"
                          }
                        },
                        "required": [
                          "kind",
                          "value"
                        ],
                        "type": "object"
                      }
                    ]
                  },
                  "packet_id": {
                    "description": "Packet identifier.",
                    "type": "string"
                  },
                  "run_id": {
                    "description": "Run identifier.",
                    "type": "string"
                  },
                  "scenario_id": {
                    "description": "Scenario identifier.",
                    "type": "string"
                  },
                  "schema_id": {
                    "description": "Schema identifier.",
                    "type": "string"
                  },
                  "stage_id": {
                    "description": "Stage identifier.",
                    "type": "string"
                  },
                  "visibility": {
                    "additionalProperties": false,
                    "properties": {
                      "labels": {
                        "description": "Visibility labels.",
                        "items": {
                          "type": "string"
                        },
                        "type": "array"
                      },
                      "policy_tags": {
                        "description": "Policy tags.",
                        "items": {
                          "type": "string"
                        },
                        "type": "array"
                      }
                    },
                    "required": [
                      "labels",
                      "policy_tags"
                    ],
                    "type": "object"
                  }
                },
                "required": [
                  "scenario_id",
                  "run_id",
                  "stage_id",
                  "packet_id",
                  "schema_id",
                  "content_type",
                  "content_hash",
                  "visibility",
                  "expiry",
                  "correlation_id",
                  "issued_at"
                ],
                "type": "object"
              },
              "payload": {
                "oneOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "json"
                      },
                      "value": {
                        "description": "Inline JSON payload.",
                        "type": [
                          "null",
                          "boolean",
                          "number",
                          "string",
                          "array",
                          "object"
                        ]
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "bytes": {
                        "items": {
                          "maximum": 255,
                          "minimum": 0,
                          "type": "integer"
                        },
                        "type": "array"
                      },
                      "kind": {
                        "const": "bytes"
                      }
                    },
                    "required": [
                      "kind",
                      "bytes"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "content_ref": {
                        "additionalProperties": false,
                        "properties": {
                          "content_hash": {
                            "additionalProperties": false,
                            "properties": {
                              "algorithm": {
                                "enum": [
                                  "sha256"
                                ],
                                "type": "string"
                              },
                              "value": {
                                "description": "Lowercase hex digest.",
                                "type": "string"
                              }
                            },
                            "required": [
                              "algorithm",
                              "value"
                            ],
                            "type": "object"
                          },
                          "encryption": {
                            "oneOf": [
                              {
                                "type": "null"
                              },
                              {
                                "description": "Encryption metadata.",
                                "type": "string"
                              }
                            ]
                          },
                          "uri": {
                            "description": "Content URI.",
                            "type": "string"
                          }
                        },
                        "required": [
                          "uri",
                          "content_hash",
                          "encryption"
                        ],
                        "type": "object"
                      },
                      "kind": {
                        "const": "external"
                      }
                    },
                    "required": [
                      "kind",
                      "content_ref"
                    ],
                    "type": "object"
                  }
                ]
              },
              "receipts": {
                "items": {
                  "additionalProperties": false,
                  "properties": {
                    "dispatch_id": {
                      "description": "Dispatch identifier.",
                      "type": "string"
                    },
                    "dispatched_at": {
                      "oneOf": [
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "unix_millis"
                            },
                            "value": {
                              "type": "integer"
                            }
                          },
                          "required": [
                            "kind",
                            "value"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "logical"
                            },
                            "value": {
                              "minimum": 0,
                              "type": "integer"
                            }
                          },
                          "required": [
                            "kind",
                            "value"
                          ],
                          "type": "object"
                        }
                      ]
                    },
                    "dispatcher": {
                      "description": "Dispatcher identifier.",
                      "type": "string"
                    },
                    "receipt_hash": {
                      "additionalProperties": false,
                      "properties": {
                        "algorithm": {
                          "enum": [
                            "sha256"
                          ],
                          "type": "string"
                        },
                        "value": {
                          "description": "Lowercase hex digest.",
                          "type": "string"
                        }
                      },
                      "required": [
                        "algorithm",
                        "value"
                      ],
                      "type": "object"
                    },
                    "target": {
                      "oneOf": [
                        {
                          "additionalProperties": false,
                          "properties": {
                            "agent_id": {
                              "description": "Agent identifier.",
                              "type": "string"
                            },
                            "kind": {
                              "const": "agent"
                            }
                          },
                          "required": [
                            "kind",
                            "agent_id"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "session"
                            },
                            "session_id": {
                              "description": "Session identifier.",
                              "type": "string"
                            }
                          },
                          "required": [
                            "kind",
                            "session_id"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "external"
                            },
                            "system": {
                              "description": "External system name.",
                              "type": "string"
                            },
                            "target": {
                              "description": "External system target.",
                              "type": "string"
                            }
                          },
                          "required": [
                            "kind",
                            "system",
                            "target"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "channel": {
                              "description": "Broadcast channel identifier.",
                              "type": "string"
                            },
                            "kind": {
                              "const": "channel"
                            }
                          },
                          "required": [
                            "kind",
                            "channel"
                          ],
                          "type": "object"
                        }
                      ]
                    }
                  },
                  "required": [
                    "dispatch_id",
                    "target",
                    "receipt_hash",
                    "dispatched_at",
                    "dispatcher"
                  ],
                  "type": "object"
                },
                "type": "array"
              }
            },
            "required": [
              "envelope",
              "payload",
              "receipts",
              "decision_id"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "run_id": {
          "description": "Run identifier.",
          "type": "string"
        },
        "scenario_id": {
          "description": "Scenario identifier.",
          "type": "string"
        },
        "spec_hash": {
          "additionalProperties": false,
          "properties": {
            "algorithm": {
              "enum": [
                "sha256"
              ],
              "type": "string"
            },
            "value": {
              "description": "Lowercase hex digest.",
              "type": "string"
            }
          },
          "required": [
            "algorithm",
            "value"
          ],
          "type": "object"
        },
        "stage_entered_at": {
          "oneOf": [
            {
              "additionalProperties": false,
              "properties": {
                "kind": {
                  "const": "unix_millis"
                },
                "value": {
                  "type": "integer"
                }
              },
              "required": [
                "kind",
                "value"
              ],
              "type": "object"
            },
            {
              "additionalProperties": false,
              "properties": {
                "kind": {
                  "const": "logical"
                },
                "value": {
                  "minimum": 0,
                  "type": "integer"
                }
              },
              "required": [
                "kind",
                "value"
              ],
              "type": "object"
            }
          ]
        },
        "status": {
          "enum": [
            "active",
            "completed",
            "failed"
          ],
          "type": "string"
        },
        "submissions": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "content_hash": {
                "additionalProperties": false,
                "properties": {
                  "algorithm": {
                    "enum": [
                      "sha256"
                    ],
                    "type": "string"
                  },
                  "value": {
                    "description": "Lowercase hex digest.",
                    "type": "string"
                  }
                },
                "required": [
                  "algorithm",
                  "value"
                ],
                "type": "object"
              },
              "content_type": {
                "description": "Submission content type.",
                "type": "string"
              },
              "correlation_id": {
                "oneOf": [
                  {
                    "type": "null"
                  },
                  {
                    "description": "Correlation identifier.",
                    "type": "string"
                  }
                ]
              },
              "payload": {
                "oneOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "json"
                      },
                      "value": {
                        "description": "Inline JSON payload.",
                        "type": [
                          "null",
                          "boolean",
                          "number",
                          "string",
                          "array",
                          "object"
                        ]
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "bytes": {
                        "items": {
                          "maximum": 255,
                          "minimum": 0,
                          "type": "integer"
                        },
                        "type": "array"
                      },
                      "kind": {
                        "const": "bytes"
                      }
                    },
                    "required": [
                      "kind",
                      "bytes"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "content_ref": {
                        "additionalProperties": false,
                        "properties": {
                          "content_hash": {
                            "additionalProperties": false,
                            "properties": {
                              "algorithm": {
                                "enum": [
                                  "sha256"
                                ],
                                "type": "string"
                              },
                              "value": {
                                "description": "Lowercase hex digest.",
                                "type": "string"
                              }
                            },
                            "required": [
                              "algorithm",
                              "value"
                            ],
                            "type": "object"
                          },
                          "encryption": {
                            "oneOf": [
                              {
                                "type": "null"
                              },
                              {
                                "description": "Encryption metadata.",
                                "type": "string"
                              }
                            ]
                          },
                          "uri": {
                            "description": "Content URI.",
                            "type": "string"
                          }
                        },
                        "required": [
                          "uri",
                          "content_hash",
                          "encryption"
                        ],
                        "type": "object"
                      },
                      "kind": {
                        "const": "external"
                      }
                    },
                    "required": [
                      "kind",
                      "content_ref"
                    ],
                    "type": "object"
                  }
                ]
              },
              "run_id": {
                "description": "Run identifier.",
                "type": "string"
              },
              "submission_id": {
                "description": "Submission identifier.",
                "type": "string"
              },
              "submitted_at": {
                "oneOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "unix_millis"
                      },
                      "value": {
                        "type": "integer"
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "logical"
                      },
                      "value": {
                        "minimum": 0,
                        "type": "integer"
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  }
                ]
              }
            },
            "required": [
              "submission_id",
              "run_id",
              "payload",
              "content_type",
              "content_hash",
              "submitted_at",
              "correlation_id"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "tenant_id": {
          "description": "Tenant identifier.",
          "minimum": 1,
          "type": "integer"
        },
        "tool_calls": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "call_id": {
                "description": "Tool-call identifier.",
                "type": "string"
              },
              "called_at": {
                "oneOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "unix_millis"
                      },
                      "value": {
                        "type": "integer"
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "logical"
                      },
                      "value": {
                        "minimum": 0,
                        "type": "integer"
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  }
                ]
              },
              "correlation_id": {
                "oneOf": [
                  {
                    "type": "null"
                  },
                  {
                    "description": "Correlation identifier.",
                    "type": "string"
                  }
                ]
              },
              "error": {
                "oneOf": [
                  {
                    "type": "null"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "code": {
                        "description": "Stable error code.",
                        "type": "string"
                      },
                      "details": {
                        "oneOf": [
                          {
                            "type": "null"
                          },
                          {
                            "oneOf": [
                              {
                                "additionalProperties": false,
                                "properties": {
                                  "blocked_by_policy": {
                                    "type": "boolean"
                                  },
                                  "kind": {
                                    "const": "provider_missing"
                                  },
                                  "missing_providers": {
                                    "description": "Missing provider identifiers.",
                                    "items": {
                                      "type": "string"
                                    },
                                    "type": "array"
                                  },
                                  "required_capabilities": {
                                    "description": "Required capabilities.",
                                    "items": {
                                      "type": "string"
                                    },
                                    "type": "array"
                                  }
                                },
                                "required": [
                                  "kind",
                                  "missing_providers",
                                  "required_capabilities",
                                  "blocked_by_policy"
                                ],
                                "type": "object"
                              },
                              {
                                "additionalProperties": false,
                                "properties": {
                                  "info": {
                                    "description": "Additional error details.",
                                    "type": "string"
                                  },
                                  "kind": {
                                    "const": "message"
                                  }
                                },
                                "required": [
                                  "kind",
                                  "info"
                                ],
                                "type": "object"
                              }
                            ]
                          }
                        ]
                      },
                      "message": {
                        "description": "Error message.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "code",
                      "message",
                      "details"
                    ],
                    "type": "object"
                  }
                ]
              },
              "method": {
                "description": "Tool method name.",
                "type": "string"
              },
              "request_hash": {
                "additionalProperties": false,
                "properties": {
                  "algorithm": {
                    "enum": [
                      "sha256"
                    ],
                    "type": "string"
                  },
                  "value": {
                    "description": "Lowercase hex digest.",
                    "type": "string"
                  }
                },
                "required": [
                  "algorithm",
                  "value"
                ],
                "type": "object"
              },
              "response_hash": {
                "additionalProperties": false,
                "properties": {
                  "algorithm": {
                    "enum": [
                      "sha256"
                    ],
                    "type": "string"
                  },
                  "value": {
                    "description": "Lowercase hex digest.",
                    "type": "string"
                  }
                },
                "required": [
                  "algorithm",
                  "value"
                ],
                "type": "object"
              }
            },
            "required": [
              "call_id",
              "method",
              "request_hash",
              "response_hash",
              "called_at",
              "correlation_id",
              "error"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "triggers": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "event": {
                "additionalProperties": false,
                "properties": {
                  "correlation_id": {
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "description": "Correlation identifier.",
                        "type": "string"
                      }
                    ]
                  },
                  "kind": {
                    "enum": [
                      "agent_request_next",
                      "tick",
                      "external_event",
                      "backend_event"
                    ],
                    "type": "string"
                  },
                  "namespace_id": {
                    "description": "Namespace identifier.",
                    "minimum": 1,
                    "type": "integer"
                  },
                  "payload": {
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "oneOf": [
                          {
                            "additionalProperties": false,
                            "properties": {
                              "kind": {
                                "const": "json"
                              },
                              "value": {
                                "description": "Inline JSON payload.",
                                "type": [
                                  "null",
                                  "boolean",
                                  "number",
                                  "string",
                                  "array",
                                  "object"
                                ]
                              }
                            },
                            "required": [
                              "kind",
                              "value"
                            ],
                            "type": "object"
                          },
                          {
                            "additionalProperties": false,
                            "properties": {
                              "bytes": {
                                "items": {
                                  "maximum": 255,
                                  "minimum": 0,
                                  "type": "integer"
                                },
                                "type": "array"
                              },
                              "kind": {
                                "const": "bytes"
                              }
                            },
                            "required": [
                              "kind",
                              "bytes"
                            ],
                            "type": "object"
                          },
                          {
                            "additionalProperties": false,
                            "properties": {
                              "content_ref": {
                                "additionalProperties": false,
                                "properties": {
                                  "content_hash": {
                                    "additionalProperties": false,
                                    "properties": {
                                      "algorithm": {
                                        "enum": [
                                          "sha256"
                                        ],
                                        "type": "string"
                                      },
                                      "value": {
                                        "description": "Lowercase hex digest.",
                                        "type": "string"
                                      }
                                    },
                                    "required": [
                                      "algorithm",
                                      "value"
                                    ],
                                    "type": "object"
                                  },
                                  "encryption": {
                                    "oneOf": [
                                      {
                                        "type": "null"
                                      },
                                      {
                                        "description": "Encryption metadata.",
                                        "type": "string"
                                      }
                                    ]
                                  },
                                  "uri": {
                                    "description": "Content URI.",
                                    "type": "string"
                                  }
                                },
                                "required": [
                                  "uri",
                                  "content_hash",
                                  "encryption"
                                ],
                                "type": "object"
                              },
                              "kind": {
                                "const": "external"
                              }
                            },
                            "required": [
                              "kind",
                              "content_ref"
                            ],
                            "type": "object"
                          }
                        ]
                      }
                    ]
                  },
                  "run_id": {
                    "description": "Run identifier.",
                    "type": "string"
                  },
                  "source_id": {
                    "description": "Trigger source identifier.",
                    "type": "string"
                  },
                  "tenant_id": {
                    "description": "Tenant identifier.",
                    "minimum": 1,
                    "type": "integer"
                  },
                  "time": {
                    "oneOf": [
                      {
                        "additionalProperties": false,
                        "properties": {
                          "kind": {
                            "const": "unix_millis"
                          },
                          "value": {
                            "type": "integer"
                          }
                        },
                        "required": [
                          "kind",
                          "value"
                        ],
                        "type": "object"
                      },
                      {
                        "additionalProperties": false,
                        "properties": {
                          "kind": {
                            "const": "logical"
                          },
                          "value": {
                            "minimum": 0,
                            "type": "integer"
                          }
                        },
                        "required": [
                          "kind",
                          "value"
                        ],
                        "type": "object"
                      }
                    ]
                  },
                  "trigger_id": {
                    "description": "Trigger identifier.",
                    "type": "string"
                  }
                },
                "required": [
                  "trigger_id",
                  "tenant_id",
                  "namespace_id",
                  "run_id",
                  "kind",
                  "time",
                  "source_id"
                ],
                "type": "object"
              },
              "seq": {
                "minimum": 0,
                "type": "integer"
              }
            },
            "required": [
              "seq",
              "event"
            ],
            "type": "object"
          },
          "type": "array"
        }
      },
      "required": [
        "tenant_id",
        "namespace_id",
        "run_id",
        "scenario_id",
        "spec_hash",
        "current_stage_id",
        "stage_entered_at",
        "status",
        "dispatch_targets",
        "triggers",
        "gate_evals",
        "decisions",
        "packets",
        "submissions",
        "tool_calls"
      ],
      "type": "object"
    }
  },
  {
    "description": "Fetch a read-only run snapshot and safe summary without changing state.",
    "examples": [
      {
        "description": "Poll run status without advancing the run.",
        "input": {
          "request": {
            "correlation_id": null,
            "namespace_id": 1,
            "requested_at": {
              "kind": "unix_millis",
              "value": 1710000000000
            },
            "run_id": "run-0001",
            "tenant_id": 1
          },
          "scenario_id": "example-scenario"
        },
        "output": {
          "current_stage_id": "main",
          "issued_packet_ids": [],
          "last_decision": null,
          "run_id": "run-0001",
          "safe_summary": null,
          "scenario_id": "example-scenario",
          "status": "active"
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "request": {
          "additionalProperties": false,
          "description": "Status request payload.",
          "properties": {
            "correlation_id": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Correlation identifier.",
                  "type": "string"
                }
              ]
            },
            "namespace_id": {
              "description": "Namespace identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "requested_at": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            },
            "run_id": {
              "description": "Run identifier.",
              "type": "string"
            },
            "tenant_id": {
              "description": "Tenant identifier.",
              "minimum": 1,
              "type": "integer"
            }
          },
          "required": [
            "tenant_id",
            "namespace_id",
            "run_id",
            "requested_at"
          ],
          "type": "object"
        },
        "scenario_id": {
          "description": "Scenario identifier.",
          "type": "string"
        }
      },
      "required": [
        "scenario_id",
        "request"
      ],
      "type": "object"
    },
    "name": "scenario_status",
    "notes": [
      "Use for polling or UI state; does not evaluate gates.",
      "Safe summaries omit evidence values and may include retry hints.",
      "Returns issued packet IDs to help track disclosures."
    ],
    "output_schema": {
      "additionalProperties": false,
      "properties": {
        "current_stage_id": {
          "description": "Current stage identifier.",
          "type": "string"
        },
        "issued_packet_ids": {
          "items": {
            "description": "Packet identifier.",
            "type": "string"
          },
          "type": "array"
        },
        "last_decision": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "additionalProperties": false,
              "properties": {
                "correlation_id": {
                  "oneOf": [
                    {
                      "type": "null"
                    },
                    {
                      "description": "Correlation identifier.",
                      "type": "string"
                    }
                  ]
                },
                "decided_at": {
                  "oneOf": [
                    {
                      "additionalProperties": false,
                      "properties": {
                        "kind": {
                          "const": "unix_millis"
                        },
                        "value": {
                          "type": "integer"
                        }
                      },
                      "required": [
                        "kind",
                        "value"
                      ],
                      "type": "object"
                    },
                    {
                      "additionalProperties": false,
                      "properties": {
                        "kind": {
                          "const": "logical"
                        },
                        "value": {
                          "minimum": 0,
                          "type": "integer"
                        }
                      },
                      "required": [
                        "kind",
                        "value"
                      ],
                      "type": "object"
                    }
                  ]
                },
                "decision_id": {
                  "description": "Decision identifier.",
                  "type": "string"
                },
                "outcome": {
                  "oneOf": [
                    {
                      "additionalProperties": false,
                      "properties": {
                        "kind": {
                          "const": "start"
                        },
                        "stage_id": {
                          "description": "Initial stage identifier.",
                          "type": "string"
                        }
                      },
                      "required": [
                        "kind",
                        "stage_id"
                      ],
                      "type": "object"
                    },
                    {
                      "additionalProperties": false,
                      "properties": {
                        "kind": {
                          "const": "complete"
                        },
                        "stage_id": {
                          "description": "Terminal stage identifier.",
                          "type": "string"
                        }
                      },
                      "required": [
                        "kind",
                        "stage_id"
                      ],
                      "type": "object"
                    },
                    {
                      "additionalProperties": false,
                      "properties": {
                        "from_stage": {
                          "description": "Previous stage identifier.",
                          "type": "string"
                        },
                        "kind": {
                          "const": "advance"
                        },
                        "timeout": {
                          "type": "boolean"
                        },
                        "to_stage": {
                          "description": "Next stage identifier.",
                          "type": "string"
                        }
                      },
                      "required": [
                        "kind",
                        "from_stage",
                        "to_stage",
                        "timeout"
                      ],
                      "type": "object"
                    },
                    {
                      "additionalProperties": false,
                      "properties": {
                        "kind": {
                          "const": "hold"
                        },
                        "summary": {
                          "additionalProperties": false,
                          "properties": {
                            "policy_tags": {
                              "description": "Policy tags applied to the summary.",
                              "items": {
                                "type": "string"
                              },
                              "type": "array"
                            },
                            "retry_hint": {
                              "oneOf": [
                                {
                                  "type": "null"
                                },
                                {
                                  "description": "Optional retry hint.",
                                  "type": "string"
                                }
                              ]
                            },
                            "status": {
                              "description": "Summary status.",
                              "type": "string"
                            },
                            "unmet_gates": {
                              "items": {
                                "description": "Gate identifier.",
                                "type": "string"
                              },
                              "type": "array"
                            }
                          },
                          "required": [
                            "status",
                            "unmet_gates",
                            "retry_hint",
                            "policy_tags"
                          ],
                          "type": "object"
                        }
                      },
                      "required": [
                        "kind",
                        "summary"
                      ],
                      "type": "object"
                    },
                    {
                      "additionalProperties": false,
                      "properties": {
                        "kind": {
                          "const": "fail"
                        },
                        "reason": {
                          "description": "Failure reason.",
                          "type": "string"
                        }
                      },
                      "required": [
                        "kind",
                        "reason"
                      ],
                      "type": "object"
                    }
                  ]
                },
                "seq": {
                  "minimum": 0,
                  "type": "integer"
                },
                "stage_id": {
                  "description": "Stage identifier.",
                  "type": "string"
                },
                "trigger_id": {
                  "description": "Trigger identifier.",
                  "type": "string"
                }
              },
              "required": [
                "decision_id",
                "seq",
                "trigger_id",
                "stage_id",
                "decided_at",
                "outcome",
                "correlation_id"
              ],
              "type": "object"
            }
          ]
        },
        "namespace_id": {
          "description": "Namespace identifier.",
          "minimum": 1,
          "type": "integer"
        },
        "run_id": {
          "description": "Run identifier.",
          "type": "string"
        },
        "safe_summary": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "additionalProperties": false,
              "properties": {
                "policy_tags": {
                  "description": "Policy tags applied to the summary.",
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                },
                "retry_hint": {
                  "oneOf": [
                    {
                      "type": "null"
                    },
                    {
                      "description": "Optional retry hint.",
                      "type": "string"
                    }
                  ]
                },
                "status": {
                  "description": "Summary status.",
                  "type": "string"
                },
                "unmet_gates": {
                  "items": {
                    "description": "Gate identifier.",
                    "type": "string"
                  },
                  "type": "array"
                }
              },
              "required": [
                "status",
                "unmet_gates",
                "retry_hint",
                "policy_tags"
              ],
              "type": "object"
            }
          ]
        },
        "scenario_id": {
          "description": "Scenario identifier.",
          "type": "string"
        },
        "status": {
          "enum": [
            "active",
            "completed",
            "failed"
          ],
          "type": "string"
        }
      },
      "required": [
        "run_id",
        "scenario_id",
        "current_stage_id",
        "status",
        "last_decision",
        "issued_packet_ids",
        "safe_summary"
      ],
      "type": "object"
    }
  },
  {
    "description": "Evaluate gates in response to an agent-driven next request.",
    "examples": [
      {
        "description": "Evaluate the next agent-driven step for a run.",
        "input": {
          "request": {
            "agent_id": "agent-alpha",
            "correlation_id": null,
            "namespace_id": 1,
            "run_id": "run-0001",
            "tenant_id": 1,
            "time": {
              "kind": "unix_millis",
              "value": 1710000000000
            },
            "trigger_id": "trigger-0001"
          },
          "scenario_id": "example-scenario"
        },
        "output": {
          "decision": {
            "correlation_id": null,
            "decided_at": {
              "kind": "unix_millis",
              "value": 1710000000000
            },
            "decision_id": "decision-0001",
            "outcome": {
              "kind": "complete",
              "stage_id": "main"
            },
            "seq": 0,
            "stage_id": "main",
            "trigger_id": "trigger-0001"
          },
          "packets": [],
          "status": "completed"
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "request": {
          "additionalProperties": false,
          "description": "Next request payload from an agent.",
          "properties": {
            "agent_id": {
              "description": "Agent identifier.",
              "type": "string"
            },
            "correlation_id": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Correlation identifier.",
                  "type": "string"
                }
              ]
            },
            "namespace_id": {
              "description": "Namespace identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "run_id": {
              "description": "Run identifier.",
              "type": "string"
            },
            "tenant_id": {
              "description": "Tenant identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "time": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            },
            "trigger_id": {
              "description": "Trigger identifier.",
              "type": "string"
            }
          },
          "required": [
            "tenant_id",
            "namespace_id",
            "run_id",
            "trigger_id",
            "agent_id",
            "time"
          ],
          "type": "object"
        },
        "scenario_id": {
          "description": "Scenario identifier.",
          "type": "string"
        }
      },
      "required": [
        "scenario_id",
        "request"
      ],
      "type": "object"
    },
    "name": "scenario_next",
    "notes": [
      "Idempotent by trigger_id; repeated calls return the same decision.",
      "Records decision, evidence, and packet disclosures in run state.",
      "Requires an active run; completed or failed runs do not advance."
    ],
    "output_schema": {
      "additionalProperties": false,
      "properties": {
        "decision": {
          "additionalProperties": false,
          "properties": {
            "correlation_id": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Correlation identifier.",
                  "type": "string"
                }
              ]
            },
            "decided_at": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            },
            "decision_id": {
              "description": "Decision identifier.",
              "type": "string"
            },
            "outcome": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "start"
                    },
                    "stage_id": {
                      "description": "Initial stage identifier.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "stage_id"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "complete"
                    },
                    "stage_id": {
                      "description": "Terminal stage identifier.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "stage_id"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "from_stage": {
                      "description": "Previous stage identifier.",
                      "type": "string"
                    },
                    "kind": {
                      "const": "advance"
                    },
                    "timeout": {
                      "type": "boolean"
                    },
                    "to_stage": {
                      "description": "Next stage identifier.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "from_stage",
                    "to_stage",
                    "timeout"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "hold"
                    },
                    "summary": {
                      "additionalProperties": false,
                      "properties": {
                        "policy_tags": {
                          "description": "Policy tags applied to the summary.",
                          "items": {
                            "type": "string"
                          },
                          "type": "array"
                        },
                        "retry_hint": {
                          "oneOf": [
                            {
                              "type": "null"
                            },
                            {
                              "description": "Optional retry hint.",
                              "type": "string"
                            }
                          ]
                        },
                        "status": {
                          "description": "Summary status.",
                          "type": "string"
                        },
                        "unmet_gates": {
                          "items": {
                            "description": "Gate identifier.",
                            "type": "string"
                          },
                          "type": "array"
                        }
                      },
                      "required": [
                        "status",
                        "unmet_gates",
                        "retry_hint",
                        "policy_tags"
                      ],
                      "type": "object"
                    }
                  },
                  "required": [
                    "kind",
                    "summary"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "fail"
                    },
                    "reason": {
                      "description": "Failure reason.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "reason"
                  ],
                  "type": "object"
                }
              ]
            },
            "seq": {
              "minimum": 0,
              "type": "integer"
            },
            "stage_id": {
              "description": "Stage identifier.",
              "type": "string"
            },
            "trigger_id": {
              "description": "Trigger identifier.",
              "type": "string"
            }
          },
          "required": [
            "decision_id",
            "seq",
            "trigger_id",
            "stage_id",
            "decided_at",
            "outcome",
            "correlation_id"
          ],
          "type": "object"
        },
        "packets": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "decision_id": {
                "description": "Decision identifier.",
                "type": "string"
              },
              "envelope": {
                "additionalProperties": false,
                "properties": {
                  "content_hash": {
                    "additionalProperties": false,
                    "properties": {
                      "algorithm": {
                        "enum": [
                          "sha256"
                        ],
                        "type": "string"
                      },
                      "value": {
                        "description": "Lowercase hex digest.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "algorithm",
                      "value"
                    ],
                    "type": "object"
                  },
                  "content_type": {
                    "description": "Packet content type.",
                    "type": "string"
                  },
                  "correlation_id": {
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "description": "Correlation identifier.",
                        "type": "string"
                      }
                    ]
                  },
                  "expiry": {
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "oneOf": [
                          {
                            "additionalProperties": false,
                            "properties": {
                              "kind": {
                                "const": "unix_millis"
                              },
                              "value": {
                                "type": "integer"
                              }
                            },
                            "required": [
                              "kind",
                              "value"
                            ],
                            "type": "object"
                          },
                          {
                            "additionalProperties": false,
                            "properties": {
                              "kind": {
                                "const": "logical"
                              },
                              "value": {
                                "minimum": 0,
                                "type": "integer"
                              }
                            },
                            "required": [
                              "kind",
                              "value"
                            ],
                            "type": "object"
                          }
                        ]
                      }
                    ]
                  },
                  "issued_at": {
                    "oneOf": [
                      {
                        "additionalProperties": false,
                        "properties": {
                          "kind": {
                            "const": "unix_millis"
                          },
                          "value": {
                            "type": "integer"
                          }
                        },
                        "required": [
                          "kind",
                          "value"
                        ],
                        "type": "object"
                      },
                      {
                        "additionalProperties": false,
                        "properties": {
                          "kind": {
                            "const": "logical"
                          },
                          "value": {
                            "minimum": 0,
                            "type": "integer"
                          }
                        },
                        "required": [
                          "kind",
                          "value"
                        ],
                        "type": "object"
                      }
                    ]
                  },
                  "packet_id": {
                    "description": "Packet identifier.",
                    "type": "string"
                  },
                  "run_id": {
                    "description": "Run identifier.",
                    "type": "string"
                  },
                  "scenario_id": {
                    "description": "Scenario identifier.",
                    "type": "string"
                  },
                  "schema_id": {
                    "description": "Schema identifier.",
                    "type": "string"
                  },
                  "stage_id": {
                    "description": "Stage identifier.",
                    "type": "string"
                  },
                  "visibility": {
                    "additionalProperties": false,
                    "properties": {
                      "labels": {
                        "description": "Visibility labels.",
                        "items": {
                          "type": "string"
                        },
                        "type": "array"
                      },
                      "policy_tags": {
                        "description": "Policy tags.",
                        "items": {
                          "type": "string"
                        },
                        "type": "array"
                      }
                    },
                    "required": [
                      "labels",
                      "policy_tags"
                    ],
                    "type": "object"
                  }
                },
                "required": [
                  "scenario_id",
                  "run_id",
                  "stage_id",
                  "packet_id",
                  "schema_id",
                  "content_type",
                  "content_hash",
                  "visibility",
                  "expiry",
                  "correlation_id",
                  "issued_at"
                ],
                "type": "object"
              },
              "payload": {
                "oneOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "json"
                      },
                      "value": {
                        "description": "Inline JSON payload.",
                        "type": [
                          "null",
                          "boolean",
                          "number",
                          "string",
                          "array",
                          "object"
                        ]
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "bytes": {
                        "items": {
                          "maximum": 255,
                          "minimum": 0,
                          "type": "integer"
                        },
                        "type": "array"
                      },
                      "kind": {
                        "const": "bytes"
                      }
                    },
                    "required": [
                      "kind",
                      "bytes"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "content_ref": {
                        "additionalProperties": false,
                        "properties": {
                          "content_hash": {
                            "additionalProperties": false,
                            "properties": {
                              "algorithm": {
                                "enum": [
                                  "sha256"
                                ],
                                "type": "string"
                              },
                              "value": {
                                "description": "Lowercase hex digest.",
                                "type": "string"
                              }
                            },
                            "required": [
                              "algorithm",
                              "value"
                            ],
                            "type": "object"
                          },
                          "encryption": {
                            "oneOf": [
                              {
                                "type": "null"
                              },
                              {
                                "description": "Encryption metadata.",
                                "type": "string"
                              }
                            ]
                          },
                          "uri": {
                            "description": "Content URI.",
                            "type": "string"
                          }
                        },
                        "required": [
                          "uri",
                          "content_hash",
                          "encryption"
                        ],
                        "type": "object"
                      },
                      "kind": {
                        "const": "external"
                      }
                    },
                    "required": [
                      "kind",
                      "content_ref"
                    ],
                    "type": "object"
                  }
                ]
              },
              "receipts": {
                "items": {
                  "additionalProperties": false,
                  "properties": {
                    "dispatch_id": {
                      "description": "Dispatch identifier.",
                      "type": "string"
                    },
                    "dispatched_at": {
                      "oneOf": [
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "unix_millis"
                            },
                            "value": {
                              "type": "integer"
                            }
                          },
                          "required": [
                            "kind",
                            "value"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "logical"
                            },
                            "value": {
                              "minimum": 0,
                              "type": "integer"
                            }
                          },
                          "required": [
                            "kind",
                            "value"
                          ],
                          "type": "object"
                        }
                      ]
                    },
                    "dispatcher": {
                      "description": "Dispatcher identifier.",
                      "type": "string"
                    },
                    "receipt_hash": {
                      "additionalProperties": false,
                      "properties": {
                        "algorithm": {
                          "enum": [
                            "sha256"
                          ],
                          "type": "string"
                        },
                        "value": {
                          "description": "Lowercase hex digest.",
                          "type": "string"
                        }
                      },
                      "required": [
                        "algorithm",
                        "value"
                      ],
                      "type": "object"
                    },
                    "target": {
                      "oneOf": [
                        {
                          "additionalProperties": false,
                          "properties": {
                            "agent_id": {
                              "description": "Agent identifier.",
                              "type": "string"
                            },
                            "kind": {
                              "const": "agent"
                            }
                          },
                          "required": [
                            "kind",
                            "agent_id"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "session"
                            },
                            "session_id": {
                              "description": "Session identifier.",
                              "type": "string"
                            }
                          },
                          "required": [
                            "kind",
                            "session_id"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "external"
                            },
                            "system": {
                              "description": "External system name.",
                              "type": "string"
                            },
                            "target": {
                              "description": "External system target.",
                              "type": "string"
                            }
                          },
                          "required": [
                            "kind",
                            "system",
                            "target"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "channel": {
                              "description": "Broadcast channel identifier.",
                              "type": "string"
                            },
                            "kind": {
                              "const": "channel"
                            }
                          },
                          "required": [
                            "kind",
                            "channel"
                          ],
                          "type": "object"
                        }
                      ]
                    }
                  },
                  "required": [
                    "dispatch_id",
                    "target",
                    "receipt_hash",
                    "dispatched_at",
                    "dispatcher"
                  ],
                  "type": "object"
                },
                "type": "array"
              }
            },
            "required": [
              "envelope",
              "payload",
              "receipts",
              "decision_id"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "status": {
          "enum": [
            "active",
            "completed",
            "failed"
          ],
          "type": "string"
        }
      },
      "required": [
        "decision",
        "packets",
        "status"
      ],
      "type": "object"
    }
  },
  {
    "description": "Submit external artifacts into run state for audit and later evaluation.",
    "examples": [
      {
        "description": "Submit an external artifact for audit and later evaluation.",
        "input": {
          "request": {
            "content_type": "application/json",
            "correlation_id": null,
            "namespace_id": 1,
            "payload": {
              "kind": "json",
              "value": {
                "artifact": "attestation",
                "status": "approved"
              }
            },
            "run_id": "run-0001",
            "submission_id": "submission-0001",
            "submitted_at": {
              "kind": "unix_millis",
              "value": 1710000000000
            },
            "tenant_id": 1
          },
          "scenario_id": "example-scenario"
        },
        "output": {
          "record": {
            "content_hash": {
              "algorithm": "sha256",
              "value": "5c3a5b6bce0f4a2c9e22c4fa6a1e6d8d90b0f2dfed1b7f1e9b3d3b3d1f0c9b21"
            },
            "content_type": "application/json",
            "correlation_id": null,
            "payload": {
              "kind": "json",
              "value": {
                "artifact": "attestation",
                "status": "approved"
              }
            },
            "run_id": "run-0001",
            "submission_id": "submission-0001",
            "submitted_at": {
              "kind": "unix_millis",
              "value": 1710000000000
            }
          }
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "request": {
          "additionalProperties": false,
          "description": "Submission payload and metadata.",
          "properties": {
            "content_type": {
              "description": "Submission content type.",
              "type": "string"
            },
            "correlation_id": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Correlation identifier.",
                  "type": "string"
                }
              ]
            },
            "namespace_id": {
              "description": "Namespace identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "payload": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "json"
                    },
                    "value": {
                      "description": "Inline JSON payload.",
                      "type": [
                        "null",
                        "boolean",
                        "number",
                        "string",
                        "array",
                        "object"
                      ]
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "bytes": {
                      "items": {
                        "maximum": 255,
                        "minimum": 0,
                        "type": "integer"
                      },
                      "type": "array"
                    },
                    "kind": {
                      "const": "bytes"
                    }
                  },
                  "required": [
                    "kind",
                    "bytes"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "content_ref": {
                      "additionalProperties": false,
                      "properties": {
                        "content_hash": {
                          "additionalProperties": false,
                          "properties": {
                            "algorithm": {
                              "enum": [
                                "sha256"
                              ],
                              "type": "string"
                            },
                            "value": {
                              "description": "Lowercase hex digest.",
                              "type": "string"
                            }
                          },
                          "required": [
                            "algorithm",
                            "value"
                          ],
                          "type": "object"
                        },
                        "encryption": {
                          "oneOf": [
                            {
                              "type": "null"
                            },
                            {
                              "description": "Encryption metadata.",
                              "type": "string"
                            }
                          ]
                        },
                        "uri": {
                          "description": "Content URI.",
                          "type": "string"
                        }
                      },
                      "required": [
                        "uri",
                        "content_hash",
                        "encryption"
                      ],
                      "type": "object"
                    },
                    "kind": {
                      "const": "external"
                    }
                  },
                  "required": [
                    "kind",
                    "content_ref"
                  ],
                  "type": "object"
                }
              ]
            },
            "run_id": {
              "description": "Run identifier.",
              "type": "string"
            },
            "submission_id": {
              "description": "Submission identifier.",
              "type": "string"
            },
            "submitted_at": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            },
            "tenant_id": {
              "description": "Tenant identifier.",
              "minimum": 1,
              "type": "integer"
            }
          },
          "required": [
            "tenant_id",
            "namespace_id",
            "run_id",
            "submission_id",
            "payload",
            "content_type",
            "submitted_at"
          ],
          "type": "object"
        },
        "scenario_id": {
          "description": "Scenario identifier.",
          "type": "string"
        }
      },
      "required": [
        "scenario_id",
        "request"
      ],
      "type": "object"
    },
    "name": "scenario_submit",
    "notes": [
      "Payload is hashed and stored as a submission record.",
      "Does not advance the run by itself.",
      "Use for artifacts the model or operator supplies."
    ],
    "output_schema": {
      "additionalProperties": false,
      "properties": {
        "record": {
          "additionalProperties": false,
          "properties": {
            "content_hash": {
              "additionalProperties": false,
              "properties": {
                "algorithm": {
                  "enum": [
                    "sha256"
                  ],
                  "type": "string"
                },
                "value": {
                  "description": "Lowercase hex digest.",
                  "type": "string"
                }
              },
              "required": [
                "algorithm",
                "value"
              ],
              "type": "object"
            },
            "content_type": {
              "description": "Submission content type.",
              "type": "string"
            },
            "correlation_id": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Correlation identifier.",
                  "type": "string"
                }
              ]
            },
            "payload": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "json"
                    },
                    "value": {
                      "description": "Inline JSON payload.",
                      "type": [
                        "null",
                        "boolean",
                        "number",
                        "string",
                        "array",
                        "object"
                      ]
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "bytes": {
                      "items": {
                        "maximum": 255,
                        "minimum": 0,
                        "type": "integer"
                      },
                      "type": "array"
                    },
                    "kind": {
                      "const": "bytes"
                    }
                  },
                  "required": [
                    "kind",
                    "bytes"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "content_ref": {
                      "additionalProperties": false,
                      "properties": {
                        "content_hash": {
                          "additionalProperties": false,
                          "properties": {
                            "algorithm": {
                              "enum": [
                                "sha256"
                              ],
                              "type": "string"
                            },
                            "value": {
                              "description": "Lowercase hex digest.",
                              "type": "string"
                            }
                          },
                          "required": [
                            "algorithm",
                            "value"
                          ],
                          "type": "object"
                        },
                        "encryption": {
                          "oneOf": [
                            {
                              "type": "null"
                            },
                            {
                              "description": "Encryption metadata.",
                              "type": "string"
                            }
                          ]
                        },
                        "uri": {
                          "description": "Content URI.",
                          "type": "string"
                        }
                      },
                      "required": [
                        "uri",
                        "content_hash",
                        "encryption"
                      ],
                      "type": "object"
                    },
                    "kind": {
                      "const": "external"
                    }
                  },
                  "required": [
                    "kind",
                    "content_ref"
                  ],
                  "type": "object"
                }
              ]
            },
            "run_id": {
              "description": "Run identifier.",
              "type": "string"
            },
            "submission_id": {
              "description": "Submission identifier.",
              "type": "string"
            },
            "submitted_at": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            }
          },
          "required": [
            "submission_id",
            "run_id",
            "payload",
            "content_type",
            "content_hash",
            "submitted_at",
            "correlation_id"
          ],
          "type": "object"
        }
      },
      "required": [
        "record"
      ],
      "type": "object"
    }
  },
  {
    "description": "Submit a trigger event (scheduler/external) and evaluate the run.",
    "examples": [
      {
        "description": "Advance a run from a scheduler or external trigger.",
        "input": {
          "scenario_id": "example-scenario",
          "trigger": {
            "correlation_id": null,
            "kind": "tick",
            "namespace_id": 1,
            "payload": null,
            "run_id": "run-0001",
            "source_id": "scheduler-01",
            "tenant_id": 1,
            "time": {
              "kind": "unix_millis",
              "value": 1710000000000
            },
            "trigger_id": "trigger-0001"
          }
        },
        "output": {
          "decision": {
            "correlation_id": null,
            "decided_at": {
              "kind": "unix_millis",
              "value": 1710000000000
            },
            "decision_id": "decision-0001",
            "outcome": {
              "kind": "complete",
              "stage_id": "main"
            },
            "seq": 0,
            "stage_id": "main",
            "trigger_id": "trigger-0001"
          },
          "packets": [],
          "status": "completed"
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "scenario_id": {
          "description": "Scenario identifier.",
          "type": "string"
        },
        "trigger": {
          "additionalProperties": false,
          "description": "Trigger event payload.",
          "properties": {
            "correlation_id": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Correlation identifier.",
                  "type": "string"
                }
              ]
            },
            "kind": {
              "enum": [
                "agent_request_next",
                "tick",
                "external_event",
                "backend_event"
              ],
              "type": "string"
            },
            "namespace_id": {
              "description": "Namespace identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "payload": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "oneOf": [
                    {
                      "additionalProperties": false,
                      "properties": {
                        "kind": {
                          "const": "json"
                        },
                        "value": {
                          "description": "Inline JSON payload.",
                          "type": [
                            "null",
                            "boolean",
                            "number",
                            "string",
                            "array",
                            "object"
                          ]
                        }
                      },
                      "required": [
                        "kind",
                        "value"
                      ],
                      "type": "object"
                    },
                    {
                      "additionalProperties": false,
                      "properties": {
                        "bytes": {
                          "items": {
                            "maximum": 255,
                            "minimum": 0,
                            "type": "integer"
                          },
                          "type": "array"
                        },
                        "kind": {
                          "const": "bytes"
                        }
                      },
                      "required": [
                        "kind",
                        "bytes"
                      ],
                      "type": "object"
                    },
                    {
                      "additionalProperties": false,
                      "properties": {
                        "content_ref": {
                          "additionalProperties": false,
                          "properties": {
                            "content_hash": {
                              "additionalProperties": false,
                              "properties": {
                                "algorithm": {
                                  "enum": [
                                    "sha256"
                                  ],
                                  "type": "string"
                                },
                                "value": {
                                  "description": "Lowercase hex digest.",
                                  "type": "string"
                                }
                              },
                              "required": [
                                "algorithm",
                                "value"
                              ],
                              "type": "object"
                            },
                            "encryption": {
                              "oneOf": [
                                {
                                  "type": "null"
                                },
                                {
                                  "description": "Encryption metadata.",
                                  "type": "string"
                                }
                              ]
                            },
                            "uri": {
                              "description": "Content URI.",
                              "type": "string"
                            }
                          },
                          "required": [
                            "uri",
                            "content_hash",
                            "encryption"
                          ],
                          "type": "object"
                        },
                        "kind": {
                          "const": "external"
                        }
                      },
                      "required": [
                        "kind",
                        "content_ref"
                      ],
                      "type": "object"
                    }
                  ]
                }
              ]
            },
            "run_id": {
              "description": "Run identifier.",
              "type": "string"
            },
            "source_id": {
              "description": "Trigger source identifier.",
              "type": "string"
            },
            "tenant_id": {
              "description": "Tenant identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "time": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            },
            "trigger_id": {
              "description": "Trigger identifier.",
              "type": "string"
            }
          },
          "required": [
            "trigger_id",
            "tenant_id",
            "namespace_id",
            "run_id",
            "kind",
            "time",
            "source_id"
          ],
          "type": "object"
        }
      },
      "required": [
        "scenario_id",
        "trigger"
      ],
      "type": "object"
    },
    "name": "scenario_trigger",
    "notes": [
      "Trigger time is supplied by the caller; no wall-clock reads.",
      "Records the trigger event and resulting decision.",
      "Use for time-based or external system triggers."
    ],
    "output_schema": {
      "additionalProperties": false,
      "properties": {
        "decision": {
          "additionalProperties": false,
          "properties": {
            "correlation_id": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Correlation identifier.",
                  "type": "string"
                }
              ]
            },
            "decided_at": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            },
            "decision_id": {
              "description": "Decision identifier.",
              "type": "string"
            },
            "outcome": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "start"
                    },
                    "stage_id": {
                      "description": "Initial stage identifier.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "stage_id"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "complete"
                    },
                    "stage_id": {
                      "description": "Terminal stage identifier.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "stage_id"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "from_stage": {
                      "description": "Previous stage identifier.",
                      "type": "string"
                    },
                    "kind": {
                      "const": "advance"
                    },
                    "timeout": {
                      "type": "boolean"
                    },
                    "to_stage": {
                      "description": "Next stage identifier.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "from_stage",
                    "to_stage",
                    "timeout"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "hold"
                    },
                    "summary": {
                      "additionalProperties": false,
                      "properties": {
                        "policy_tags": {
                          "description": "Policy tags applied to the summary.",
                          "items": {
                            "type": "string"
                          },
                          "type": "array"
                        },
                        "retry_hint": {
                          "oneOf": [
                            {
                              "type": "null"
                            },
                            {
                              "description": "Optional retry hint.",
                              "type": "string"
                            }
                          ]
                        },
                        "status": {
                          "description": "Summary status.",
                          "type": "string"
                        },
                        "unmet_gates": {
                          "items": {
                            "description": "Gate identifier.",
                            "type": "string"
                          },
                          "type": "array"
                        }
                      },
                      "required": [
                        "status",
                        "unmet_gates",
                        "retry_hint",
                        "policy_tags"
                      ],
                      "type": "object"
                    }
                  },
                  "required": [
                    "kind",
                    "summary"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "fail"
                    },
                    "reason": {
                      "description": "Failure reason.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "kind",
                    "reason"
                  ],
                  "type": "object"
                }
              ]
            },
            "seq": {
              "minimum": 0,
              "type": "integer"
            },
            "stage_id": {
              "description": "Stage identifier.",
              "type": "string"
            },
            "trigger_id": {
              "description": "Trigger identifier.",
              "type": "string"
            }
          },
          "required": [
            "decision_id",
            "seq",
            "trigger_id",
            "stage_id",
            "decided_at",
            "outcome",
            "correlation_id"
          ],
          "type": "object"
        },
        "packets": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "decision_id": {
                "description": "Decision identifier.",
                "type": "string"
              },
              "envelope": {
                "additionalProperties": false,
                "properties": {
                  "content_hash": {
                    "additionalProperties": false,
                    "properties": {
                      "algorithm": {
                        "enum": [
                          "sha256"
                        ],
                        "type": "string"
                      },
                      "value": {
                        "description": "Lowercase hex digest.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "algorithm",
                      "value"
                    ],
                    "type": "object"
                  },
                  "content_type": {
                    "description": "Packet content type.",
                    "type": "string"
                  },
                  "correlation_id": {
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "description": "Correlation identifier.",
                        "type": "string"
                      }
                    ]
                  },
                  "expiry": {
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "oneOf": [
                          {
                            "additionalProperties": false,
                            "properties": {
                              "kind": {
                                "const": "unix_millis"
                              },
                              "value": {
                                "type": "integer"
                              }
                            },
                            "required": [
                              "kind",
                              "value"
                            ],
                            "type": "object"
                          },
                          {
                            "additionalProperties": false,
                            "properties": {
                              "kind": {
                                "const": "logical"
                              },
                              "value": {
                                "minimum": 0,
                                "type": "integer"
                              }
                            },
                            "required": [
                              "kind",
                              "value"
                            ],
                            "type": "object"
                          }
                        ]
                      }
                    ]
                  },
                  "issued_at": {
                    "oneOf": [
                      {
                        "additionalProperties": false,
                        "properties": {
                          "kind": {
                            "const": "unix_millis"
                          },
                          "value": {
                            "type": "integer"
                          }
                        },
                        "required": [
                          "kind",
                          "value"
                        ],
                        "type": "object"
                      },
                      {
                        "additionalProperties": false,
                        "properties": {
                          "kind": {
                            "const": "logical"
                          },
                          "value": {
                            "minimum": 0,
                            "type": "integer"
                          }
                        },
                        "required": [
                          "kind",
                          "value"
                        ],
                        "type": "object"
                      }
                    ]
                  },
                  "packet_id": {
                    "description": "Packet identifier.",
                    "type": "string"
                  },
                  "run_id": {
                    "description": "Run identifier.",
                    "type": "string"
                  },
                  "scenario_id": {
                    "description": "Scenario identifier.",
                    "type": "string"
                  },
                  "schema_id": {
                    "description": "Schema identifier.",
                    "type": "string"
                  },
                  "stage_id": {
                    "description": "Stage identifier.",
                    "type": "string"
                  },
                  "visibility": {
                    "additionalProperties": false,
                    "properties": {
                      "labels": {
                        "description": "Visibility labels.",
                        "items": {
                          "type": "string"
                        },
                        "type": "array"
                      },
                      "policy_tags": {
                        "description": "Policy tags.",
                        "items": {
                          "type": "string"
                        },
                        "type": "array"
                      }
                    },
                    "required": [
                      "labels",
                      "policy_tags"
                    ],
                    "type": "object"
                  }
                },
                "required": [
                  "scenario_id",
                  "run_id",
                  "stage_id",
                  "packet_id",
                  "schema_id",
                  "content_type",
                  "content_hash",
                  "visibility",
                  "expiry",
                  "correlation_id",
                  "issued_at"
                ],
                "type": "object"
              },
              "payload": {
                "oneOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "json"
                      },
                      "value": {
                        "description": "Inline JSON payload.",
                        "type": [
                          "null",
                          "boolean",
                          "number",
                          "string",
                          "array",
                          "object"
                        ]
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "bytes": {
                        "items": {
                          "maximum": 255,
                          "minimum": 0,
                          "type": "integer"
                        },
                        "type": "array"
                      },
                      "kind": {
                        "const": "bytes"
                      }
                    },
                    "required": [
                      "kind",
                      "bytes"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "content_ref": {
                        "additionalProperties": false,
                        "properties": {
                          "content_hash": {
                            "additionalProperties": false,
                            "properties": {
                              "algorithm": {
                                "enum": [
                                  "sha256"
                                ],
                                "type": "string"
                              },
                              "value": {
                                "description": "Lowercase hex digest.",
                                "type": "string"
                              }
                            },
                            "required": [
                              "algorithm",
                              "value"
                            ],
                            "type": "object"
                          },
                          "encryption": {
                            "oneOf": [
                              {
                                "type": "null"
                              },
                              {
                                "description": "Encryption metadata.",
                                "type": "string"
                              }
                            ]
                          },
                          "uri": {
                            "description": "Content URI.",
                            "type": "string"
                          }
                        },
                        "required": [
                          "uri",
                          "content_hash",
                          "encryption"
                        ],
                        "type": "object"
                      },
                      "kind": {
                        "const": "external"
                      }
                    },
                    "required": [
                      "kind",
                      "content_ref"
                    ],
                    "type": "object"
                  }
                ]
              },
              "receipts": {
                "items": {
                  "additionalProperties": false,
                  "properties": {
                    "dispatch_id": {
                      "description": "Dispatch identifier.",
                      "type": "string"
                    },
                    "dispatched_at": {
                      "oneOf": [
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "unix_millis"
                            },
                            "value": {
                              "type": "integer"
                            }
                          },
                          "required": [
                            "kind",
                            "value"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "logical"
                            },
                            "value": {
                              "minimum": 0,
                              "type": "integer"
                            }
                          },
                          "required": [
                            "kind",
                            "value"
                          ],
                          "type": "object"
                        }
                      ]
                    },
                    "dispatcher": {
                      "description": "Dispatcher identifier.",
                      "type": "string"
                    },
                    "receipt_hash": {
                      "additionalProperties": false,
                      "properties": {
                        "algorithm": {
                          "enum": [
                            "sha256"
                          ],
                          "type": "string"
                        },
                        "value": {
                          "description": "Lowercase hex digest.",
                          "type": "string"
                        }
                      },
                      "required": [
                        "algorithm",
                        "value"
                      ],
                      "type": "object"
                    },
                    "target": {
                      "oneOf": [
                        {
                          "additionalProperties": false,
                          "properties": {
                            "agent_id": {
                              "description": "Agent identifier.",
                              "type": "string"
                            },
                            "kind": {
                              "const": "agent"
                            }
                          },
                          "required": [
                            "kind",
                            "agent_id"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "session"
                            },
                            "session_id": {
                              "description": "Session identifier.",
                              "type": "string"
                            }
                          },
                          "required": [
                            "kind",
                            "session_id"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "kind": {
                              "const": "external"
                            },
                            "system": {
                              "description": "External system name.",
                              "type": "string"
                            },
                            "target": {
                              "description": "External system target.",
                              "type": "string"
                            }
                          },
                          "required": [
                            "kind",
                            "system",
                            "target"
                          ],
                          "type": "object"
                        },
                        {
                          "additionalProperties": false,
                          "properties": {
                            "channel": {
                              "description": "Broadcast channel identifier.",
                              "type": "string"
                            },
                            "kind": {
                              "const": "channel"
                            }
                          },
                          "required": [
                            "kind",
                            "channel"
                          ],
                          "type": "object"
                        }
                      ]
                    }
                  },
                  "required": [
                    "dispatch_id",
                    "target",
                    "receipt_hash",
                    "dispatched_at",
                    "dispatcher"
                  ],
                  "type": "object"
                },
                "type": "array"
              }
            },
            "required": [
              "envelope",
              "payload",
              "receipts",
              "decision_id"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "status": {
          "enum": [
            "active",
            "completed",
            "failed"
          ],
          "type": "string"
        }
      },
      "required": [
        "decision",
        "packets",
        "status"
      ],
      "type": "object"
    }
  },
  {
    "description": "Query an evidence provider with full run context and disclosure policy.",
    "examples": [
      {
        "description": "Query an evidence provider using the run context.",
        "input": {
          "context": {
            "correlation_id": null,
            "namespace_id": 1,
            "run_id": "run-0001",
            "scenario_id": "example-scenario",
            "stage_id": "main",
            "tenant_id": 1,
            "trigger_id": "trigger-0001",
            "trigger_time": {
              "kind": "unix_millis",
              "value": 1710000000000
            }
          },
          "query": {
            "params": {
              "key": "DEPLOY_ENV"
            },
            "predicate": "get",
            "provider_id": "env"
          }
        },
        "output": {
          "result": {
            "content_type": "text/plain",
            "error": null,
            "evidence_anchor": {
              "anchor_type": "env",
              "anchor_value": "DEPLOY_ENV"
            },
            "evidence_hash": {
              "algorithm": "sha256",
              "value": "5c3a5b6bce0f4a2c9e22c4fa6a1e6d8d90b0f2dfed1b7f1e9b3d3b3d1f0c9b21"
            },
            "evidence_ref": null,
            "lane": "verified",
            "signature": null,
            "value": {
              "kind": "json",
              "value": "production"
            }
          }
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "context": {
          "additionalProperties": false,
          "description": "Evidence context used for evaluation.",
          "properties": {
            "correlation_id": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Correlation identifier.",
                  "type": "string"
                }
              ]
            },
            "namespace_id": {
              "description": "Namespace identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "run_id": {
              "description": "Run identifier.",
              "type": "string"
            },
            "scenario_id": {
              "description": "Scenario identifier.",
              "type": "string"
            },
            "stage_id": {
              "description": "Stage identifier.",
              "type": "string"
            },
            "tenant_id": {
              "description": "Tenant identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "trigger_id": {
              "description": "Trigger identifier.",
              "type": "string"
            },
            "trigger_time": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            }
          },
          "required": [
            "tenant_id",
            "run_id",
            "scenario_id",
            "stage_id",
            "trigger_id",
            "trigger_time"
          ],
          "type": "object"
        },
        "query": {
          "additionalProperties": false,
          "description": "Evidence query payload.",
          "properties": {
            "params": {
              "description": "Provider-specific parameter payload.",
              "type": [
                "null",
                "boolean",
                "number",
                "string",
                "array",
                "object"
              ]
            },
            "predicate": {
              "description": "Provider predicate name.",
              "type": "string"
            },
            "provider_id": {
              "description": "Evidence provider identifier.",
              "type": "string"
            }
          },
          "required": [
            "provider_id",
            "predicate"
          ],
          "type": "object"
        }
      },
      "required": [
        "query",
        "context"
      ],
      "type": "object"
    },
    "name": "evidence_query",
    "notes": [
      "Disclosure policy may redact raw values; hashes/anchors still returned.",
      "Use for diagnostics or preflight checks; runtime uses the same provider logic.",
      "Requires provider_id, predicate, and full EvidenceContext."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "result": {
          "additionalProperties": false,
          "properties": {
            "content_type": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Evidence content type.",
                  "type": "string"
                }
              ]
            },
            "error": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "code": {
                      "description": "Stable error code.",
                      "type": "string"
                    },
                    "details": {
                      "oneOf": [
                        {
                          "type": "null"
                        },
                        {
                          "description": "Optional structured error details.",
                          "type": [
                            "null",
                            "boolean",
                            "number",
                            "string",
                            "array",
                            "object"
                          ]
                        }
                      ]
                    },
                    "message": {
                      "description": "Error message.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "code",
                    "message",
                    "details"
                  ],
                  "type": "object"
                }
              ]
            },
            "evidence_anchor": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "anchor_type": {
                      "description": "Anchor type identifier.",
                      "type": "string"
                    },
                    "anchor_value": {
                      "description": "Anchor value.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "anchor_type",
                    "anchor_value"
                  ],
                  "type": "object"
                }
              ]
            },
            "evidence_hash": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "algorithm": {
                      "enum": [
                        "sha256"
                      ],
                      "type": "string"
                    },
                    "value": {
                      "description": "Lowercase hex digest.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "algorithm",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            },
            "evidence_ref": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "uri": {
                      "description": "Evidence reference URI.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "uri"
                  ],
                  "type": "object"
                }
              ]
            },
            "lane": {
              "description": "Trust lane classification for evidence.",
              "enum": [
                "verified",
                "asserted"
              ],
              "type": "string"
            },
            "signature": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "key_id": {
                      "description": "Signing key identifier.",
                      "type": "string"
                    },
                    "scheme": {
                      "description": "Signature scheme identifier.",
                      "type": "string"
                    },
                    "signature": {
                      "items": {
                        "maximum": 255,
                        "minimum": 0,
                        "type": "integer"
                      },
                      "type": "array"
                    }
                  },
                  "required": [
                    "scheme",
                    "key_id",
                    "signature"
                  ],
                  "type": "object"
                }
              ]
            },
            "value": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "oneOf": [
                    {
                      "additionalProperties": false,
                      "properties": {
                        "kind": {
                          "const": "json"
                        },
                        "value": {
                          "description": "Evidence JSON value.",
                          "type": [
                            "null",
                            "boolean",
                            "number",
                            "string",
                            "array",
                            "object"
                          ]
                        }
                      },
                      "required": [
                        "kind",
                        "value"
                      ],
                      "type": "object"
                    },
                    {
                      "additionalProperties": false,
                      "properties": {
                        "kind": {
                          "const": "bytes"
                        },
                        "value": {
                          "items": {
                            "maximum": 255,
                            "minimum": 0,
                            "type": "integer"
                          },
                          "type": "array"
                        }
                      },
                      "required": [
                        "kind",
                        "value"
                      ],
                      "type": "object"
                    }
                  ]
                }
              ]
            }
          },
          "required": [
            "value",
            "lane",
            "error",
            "evidence_hash",
            "evidence_ref",
            "evidence_anchor",
            "signature",
            "content_type"
          ],
          "type": "object"
        }
      },
      "required": [
        "result"
      ],
      "type": "object"
    }
  },
  {
    "description": "Export deterministic runpack artifacts for offline verification.",
    "examples": [
      {
        "description": "Export a runpack with manifest metadata.",
        "input": {
          "generated_at": {
            "kind": "unix_millis",
            "value": 1710000000000
          },
          "include_verification": false,
          "manifest_name": "manifest.json",
          "namespace_id": 1,
          "output_dir": "/var/lib/decision-gate/runpacks/run-0001",
          "run_id": "run-0001",
          "scenario_id": "example-scenario",
          "tenant_id": 1
        },
        "output": {
          "manifest": {
            "artifacts": [
              {
                "artifact_id": "decision_log",
                "content_type": "application/json",
                "hash": {
                  "algorithm": "sha256",
                  "value": "5c3a5b6bce0f4a2c9e22c4fa6a1e6d8d90b0f2dfed1b7f1e9b3d3b3d1f0c9b21"
                },
                "kind": "decision_log",
                "path": "decision_log.json",
                "required": true
              }
            ],
            "generated_at": {
              "kind": "unix_millis",
              "value": 1710000000000
            },
            "hash_algorithm": "sha256",
            "integrity": {
              "file_hashes": [
                {
                  "hash": {
                    "algorithm": "sha256",
                    "value": "5c3a5b6bce0f4a2c9e22c4fa6a1e6d8d90b0f2dfed1b7f1e9b3d3b3d1f0c9b21"
                  },
                  "path": "decision_log.json"
                }
              ],
              "root_hash": {
                "algorithm": "sha256",
                "value": "5c3a5b6bce0f4a2c9e22c4fa6a1e6d8d90b0f2dfed1b7f1e9b3d3b3d1f0c9b21"
              }
            },
            "manifest_version": "v1",
            "namespace_id": 1,
            "run_id": "run-0001",
            "scenario_id": "example-scenario",
            "spec_hash": {
              "algorithm": "sha256",
              "value": "5c3a5b6bce0f4a2c9e22c4fa6a1e6d8d90b0f2dfed1b7f1e9b3d3b3d1f0c9b21"
            },
            "tenant_id": 1,
            "verifier_mode": "offline_strict"
          },
          "report": null,
          "storage_uri": null
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "generated_at": {
          "description": "Timestamp recorded in the manifest.",
          "oneOf": [
            {
              "additionalProperties": false,
              "properties": {
                "kind": {
                  "const": "unix_millis"
                },
                "value": {
                  "type": "integer"
                }
              },
              "required": [
                "kind",
                "value"
              ],
              "type": "object"
            },
            {
              "additionalProperties": false,
              "properties": {
                "kind": {
                  "const": "logical"
                },
                "value": {
                  "minimum": 0,
                  "type": "integer"
                }
              },
              "required": [
                "kind",
                "value"
              ],
              "type": "object"
            }
          ]
        },
        "include_verification": {
          "description": "Generate a verification report artifact.",
          "type": "boolean"
        },
        "manifest_name": {
          "description": "Optional override for the manifest file name.",
          "oneOf": [
            {
              "type": "null"
            },
            {
              "description": "Manifest file name.",
              "type": "string"
            }
          ]
        },
        "namespace_id": {
          "description": "Namespace identifier.",
          "minimum": 1,
          "type": "integer"
        },
        "output_dir": {
          "description": "Optional output directory (required for filesystem export).",
          "oneOf": [
            {
              "type": "null"
            },
            {
              "description": "Output directory path.",
              "type": "string"
            }
          ]
        },
        "run_id": {
          "description": "Run identifier.",
          "type": "string"
        },
        "scenario_id": {
          "description": "Scenario identifier.",
          "type": "string"
        },
        "tenant_id": {
          "description": "Tenant identifier.",
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "scenario_id",
        "tenant_id",
        "namespace_id",
        "run_id",
        "generated_at",
        "include_verification"
      ],
      "type": "object"
    },
    "name": "runpack_export",
    "notes": [
      "Writes manifest and logs to output_dir; generated_at is recorded in the manifest.",
      "include_verification adds a verification report artifact.",
      "Use after runs complete or for audit snapshots."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "manifest": {
          "additionalProperties": false,
          "properties": {
            "artifacts": {
              "items": {
                "additionalProperties": false,
                "properties": {
                  "artifact_id": {
                    "description": "Artifact identifier.",
                    "type": "string"
                  },
                  "content_type": {
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "description": "Artifact content type.",
                        "type": "string"
                      }
                    ]
                  },
                  "hash": {
                    "additionalProperties": false,
                    "properties": {
                      "algorithm": {
                        "enum": [
                          "sha256"
                        ],
                        "type": "string"
                      },
                      "value": {
                        "description": "Lowercase hex digest.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "algorithm",
                      "value"
                    ],
                    "type": "object"
                  },
                  "kind": {
                    "enum": [
                      "scenario_spec",
                      "trigger_log",
                      "gate_eval_log",
                      "decision_log",
                      "packet_log",
                      "dispatch_log",
                      "evidence_log",
                      "submission_log",
                      "tool_transcript",
                      "verifier_report",
                      "custom"
                    ],
                    "type": "string"
                  },
                  "path": {
                    "description": "Runpack-relative artifact path.",
                    "type": "string"
                  },
                  "required": {
                    "type": "boolean"
                  }
                },
                "required": [
                  "artifact_id",
                  "kind",
                  "path",
                  "content_type",
                  "hash",
                  "required"
                ],
                "type": "object"
              },
              "type": "array"
            },
            "generated_at": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            },
            "hash_algorithm": {
              "enum": [
                "sha256"
              ],
              "type": "string"
            },
            "integrity": {
              "additionalProperties": false,
              "properties": {
                "file_hashes": {
                  "items": {
                    "additionalProperties": false,
                    "properties": {
                      "hash": {
                        "additionalProperties": false,
                        "properties": {
                          "algorithm": {
                            "enum": [
                              "sha256"
                            ],
                            "type": "string"
                          },
                          "value": {
                            "description": "Lowercase hex digest.",
                            "type": "string"
                          }
                        },
                        "required": [
                          "algorithm",
                          "value"
                        ],
                        "type": "object"
                      },
                      "path": {
                        "description": "Runpack-relative artifact path.",
                        "type": "string"
                      }
                    },
                    "required": [
                      "path",
                      "hash"
                    ],
                    "type": "object"
                  },
                  "type": "array"
                },
                "root_hash": {
                  "additionalProperties": false,
                  "properties": {
                    "algorithm": {
                      "enum": [
                        "sha256"
                      ],
                      "type": "string"
                    },
                    "value": {
                      "description": "Lowercase hex digest.",
                      "type": "string"
                    }
                  },
                  "required": [
                    "algorithm",
                    "value"
                  ],
                  "type": "object"
                }
              },
              "required": [
                "file_hashes",
                "root_hash"
              ],
              "type": "object"
            },
            "manifest_version": {
              "description": "Runpack manifest version.",
              "type": "string"
            },
            "namespace_id": {
              "description": "Namespace identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "run_id": {
              "description": "Run identifier.",
              "type": "string"
            },
            "scenario_id": {
              "description": "Scenario identifier.",
              "type": "string"
            },
            "security": {
              "additionalProperties": false,
              "properties": {
                "dev_permissive": {
                  "type": "boolean"
                },
                "namespace_authority": {
                  "description": "Namespace authority mode label.",
                  "type": "string"
                }
              },
              "required": [
                "dev_permissive",
                "namespace_authority"
              ],
              "type": "object"
            },
            "spec_hash": {
              "additionalProperties": false,
              "properties": {
                "algorithm": {
                  "enum": [
                    "sha256"
                  ],
                  "type": "string"
                },
                "value": {
                  "description": "Lowercase hex digest.",
                  "type": "string"
                }
              },
              "required": [
                "algorithm",
                "value"
              ],
              "type": "object"
            },
            "tenant_id": {
              "description": "Tenant identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "verifier_mode": {
              "enum": [
                "offline_strict",
                "offline_with_fetch"
              ],
              "type": "string"
            }
          },
          "required": [
            "manifest_version",
            "generated_at",
            "tenant_id",
            "namespace_id",
            "scenario_id",
            "run_id",
            "spec_hash",
            "hash_algorithm",
            "verifier_mode",
            "integrity",
            "artifacts"
          ],
          "type": "object"
        },
        "report": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "additionalProperties": false,
              "properties": {
                "checked_files": {
                  "minimum": 0,
                  "type": "integer"
                },
                "errors": {
                  "description": "Verification error messages.",
                  "items": {
                    "type": "string"
                  },
                  "type": "array"
                },
                "status": {
                  "description": "Runpack verification status.",
                  "enum": [
                    "pass",
                    "fail"
                  ],
                  "type": "string"
                }
              },
              "required": [
                "status",
                "checked_files",
                "errors"
              ],
              "type": "object"
            }
          ]
        },
        "storage_uri": {
          "description": "Optional storage URI for managed runpack storage backends.",
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "string"
            }
          ]
        }
      },
      "required": [
        "manifest",
        "report"
      ],
      "type": "object"
    }
  },
  {
    "description": "Verify a runpack manifest and artifacts offline.",
    "examples": [
      {
        "description": "Verify a runpack manifest and artifacts offline.",
        "input": {
          "manifest_path": "manifest.json",
          "runpack_dir": "/var/lib/decision-gate/runpacks/run-0001"
        },
        "output": {
          "report": {
            "checked_files": 12,
            "errors": [],
            "status": "pass"
          },
          "status": "pass"
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "manifest_path": {
          "description": "Manifest path relative to runpack root.",
          "type": "string"
        },
        "runpack_dir": {
          "description": "Runpack root directory.",
          "type": "string"
        }
      },
      "required": [
        "runpack_dir",
        "manifest_path"
      ],
      "type": "object"
    },
    "name": "runpack_verify",
    "notes": [
      "Validates hashes, integrity root, and decision log structure.",
      "Fails closed on missing or tampered files.",
      "Use in CI or offline audit pipelines."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "report": {
          "additionalProperties": false,
          "properties": {
            "checked_files": {
              "minimum": 0,
              "type": "integer"
            },
            "errors": {
              "description": "Verification error messages.",
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "status": {
              "description": "Runpack verification status.",
              "enum": [
                "pass",
                "fail"
              ],
              "type": "string"
            }
          },
          "required": [
            "status",
            "checked_files",
            "errors"
          ],
          "type": "object"
        },
        "status": {
          "description": "Runpack verification status.",
          "enum": [
            "pass",
            "fail"
          ],
          "type": "string"
        }
      },
      "required": [
        "report",
        "status"
      ],
      "type": "object"
    }
  },
  {
    "description": "List registered evidence providers and capabilities summary.",
    "examples": [
      {
        "description": "List registered evidence providers.",
        "input": {},
        "output": {
          "providers": [
            {
              "predicates": [
                "get"
              ],
              "provider_id": "env",
              "transport": "builtin"
            }
          ]
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {},
      "required": [],
      "type": "object"
    },
    "name": "providers_list",
    "notes": [
      "Returns provider identifiers and transport metadata.",
      "Results are scoped by auth policy."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "providers": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "predicates": {
                "items": {
                  "description": "Predicate identifier.",
                  "type": "string"
                },
                "type": "array"
              },
              "provider_id": {
                "description": "Provider identifier.",
                "type": "string"
              },
              "transport": {
                "description": "Provider transport type.",
                "enum": [
                  "builtin",
                  "mcp"
                ],
                "type": "string"
              }
            },
            "required": [
              "provider_id",
              "transport",
              "predicates"
            ],
            "type": "object"
          },
          "type": "array"
        }
      },
      "required": [
        "providers"
      ],
      "type": "object"
    }
  },
  {
    "description": "Fetch the canonical provider contract JSON and hash for a provider.",
    "examples": [
      {
        "description": "Fetch the contract JSON for a provider.",
        "input": {
          "provider_id": "json"
        },
        "output": {
          "contract": {
            "config_schema": {
              "additionalProperties": false,
              "type": "object"
            },
            "description": "Reads JSON or YAML files and evaluates JSONPath.",
            "name": "JSON Provider",
            "notes": [],
            "predicates": [],
            "provider_id": "json",
            "transport": "builtin"
          },
          "contract_hash": {
            "algorithm": "sha256",
            "value": "5c3a5b6bce0f4a2c9e22c4fa6a1e6d8d90b0f2dfed1b7f1e9b3d3b3d1f0c9b21"
          },
          "provider_id": "json",
          "source": "builtin",
          "version": null
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "provider_id": {
          "description": "Provider identifier.",
          "type": "string"
        }
      },
      "required": [
        "provider_id"
      ],
      "type": "object"
    },
    "name": "provider_contract_get",
    "notes": [
      "Returns the provider contract as loaded by the MCP server.",
      "Includes a canonical hash for audit and reproducibility.",
      "Subject to provider disclosure policy and authz."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "contract": {
          "additionalProperties": false,
          "properties": {
            "config_schema": {
              "description": "Provider configuration schema.",
              "type": [
                "null",
                "boolean",
                "number",
                "string",
                "array",
                "object"
              ]
            },
            "description": {
              "description": "Provider description.",
              "type": "string"
            },
            "name": {
              "description": "Provider display name.",
              "type": "string"
            },
            "notes": {
              "description": "Provider notes and guidance.",
              "items": {
                "type": "string"
              },
              "type": "array"
            },
            "predicates": {
              "items": {
                "additionalProperties": false,
                "properties": {
                  "allowed_comparators": {
                    "description": "Comparator allow-list for this predicate.",
                    "items": {
                      "description": "Comparator applied to evidence values.",
                      "enum": [
                        "equals",
                        "not_equals",
                        "greater_than",
                        "greater_than_or_equal",
                        "less_than",
                        "less_than_or_equal",
                        "lex_greater_than",
                        "lex_greater_than_or_equal",
                        "lex_less_than",
                        "lex_less_than_or_equal",
                        "contains",
                        "in_set",
                        "deep_equals",
                        "deep_not_equals",
                        "exists",
                        "not_exists"
                      ],
                      "type": "string"
                    },
                    "type": "array"
                  },
                  "anchor_types": {
                    "description": "Anchor types emitted by this predicate.",
                    "items": {
                      "type": "string"
                    },
                    "type": "array"
                  },
                  "content_types": {
                    "description": "Content types for predicate output.",
                    "items": {
                      "type": "string"
                    },
                    "type": "array"
                  },
                  "description": {
                    "description": "Predicate description.",
                    "type": "string"
                  },
                  "determinism": {
                    "description": "Determinism classification for provider predicates.",
                    "enum": [
                      "deterministic",
                      "time_dependent",
                      "external"
                    ],
                    "type": "string"
                  },
                  "examples": {
                    "items": {
                      "additionalProperties": false,
                      "properties": {
                        "description": {
                          "description": "Short example description.",
                          "type": "string"
                        },
                        "params": {
                          "description": "Example params payload.",
                          "type": [
                            "null",
                            "boolean",
                            "number",
                            "string",
                            "array",
                            "object"
                          ]
                        },
                        "result": {
                          "description": "Example result value.",
                          "type": [
                            "null",
                            "boolean",
                            "number",
                            "string",
                            "array",
                            "object"
                          ]
                        }
                      },
                      "required": [
                        "description",
                        "params",
                        "result"
                      ],
                      "type": "object"
                    },
                    "type": "array"
                  },
                  "name": {
                    "description": "Predicate name.",
                    "type": "string"
                  },
                  "params_required": {
                    "description": "Whether params are required for this predicate.",
                    "type": "boolean"
                  },
                  "params_schema": {
                    "description": "JSON schema for predicate params.",
                    "type": [
                      "null",
                      "boolean",
                      "number",
                      "string",
                      "array",
                      "object"
                    ]
                  },
                  "result_schema": {
                    "description": "JSON schema for predicate result values.",
                    "type": [
                      "null",
                      "boolean",
                      "number",
                      "string",
                      "array",
                      "object"
                    ]
                  }
                },
                "required": [
                  "name",
                  "description",
                  "determinism",
                  "params_required",
                  "params_schema",
                  "result_schema",
                  "allowed_comparators",
                  "anchor_types",
                  "content_types",
                  "examples"
                ],
                "type": "object"
              },
              "type": "array"
            },
            "provider_id": {
              "description": "Provider identifier.",
              "type": "string"
            },
            "transport": {
              "description": "Provider transport kind.",
              "enum": [
                "builtin",
                "mcp"
              ],
              "type": "string"
            }
          },
          "required": [
            "provider_id",
            "name",
            "description",
            "transport",
            "config_schema",
            "predicates",
            "notes"
          ],
          "type": "object"
        },
        "contract_hash": {
          "additionalProperties": false,
          "properties": {
            "algorithm": {
              "enum": [
                "sha256"
              ],
              "type": "string"
            },
            "value": {
              "description": "Lowercase hex digest.",
              "type": "string"
            }
          },
          "required": [
            "algorithm",
            "value"
          ],
          "type": "object"
        },
        "provider_id": {
          "description": "Provider identifier.",
          "type": "string"
        },
        "source": {
          "description": "Contract source origin.",
          "enum": [
            "builtin",
            "file"
          ],
          "type": "string"
        },
        "version": {
          "description": "Optional contract version label.",
          "oneOf": [
            {
              "type": "null"
            },
            {
              "type": "string"
            }
          ]
        }
      },
      "required": [
        "provider_id",
        "contract",
        "contract_hash",
        "source",
        "version"
      ],
      "type": "object"
    }
  },
  {
    "description": "Fetch predicate schema details (params/result/comparators) for a provider.",
    "examples": [
      {
        "description": "Fetch predicate schema details for a provider.",
        "input": {
          "predicate": "path",
          "provider_id": "json"
        },
        "output": {
          "allowed_comparators": [
            "equals",
            "in_set",
            "exists",
            "not_exists"
          ],
          "anchor_types": [],
          "content_types": [
            "application/json"
          ],
          "contract_hash": {
            "algorithm": "sha256",
            "value": "5c3a5b6bce0f4a2c9e22c4fa6a1e6d8d90b0f2dfed1b7f1e9b3d3b3d1f0c9b21"
          },
          "determinism": "external",
          "examples": [],
          "params_required": true,
          "params_schema": {
            "properties": {
              "file": {
                "type": "string"
              },
              "jsonpath": {
                "type": "string"
              }
            },
            "required": [
              "file"
            ],
            "type": "object"
          },
          "predicate": "path",
          "provider_id": "json",
          "result_schema": {
            "type": [
              "null",
              "string",
              "number",
              "boolean",
              "array",
              "object"
            ]
          }
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "predicate": {
          "description": "Provider predicate name.",
          "type": "string"
        },
        "provider_id": {
          "description": "Provider identifier.",
          "type": "string"
        }
      },
      "required": [
        "provider_id",
        "predicate"
      ],
      "type": "object"
    },
    "name": "provider_schema_get",
    "notes": [
      "Returns compiled schema metadata for a single predicate.",
      "Includes comparator allow-lists and predicate examples.",
      "Subject to provider disclosure policy and authz."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "allowed_comparators": {
          "description": "Comparator allow-list for this predicate.",
          "items": {
            "description": "Comparator applied to evidence values.",
            "enum": [
              "equals",
              "not_equals",
              "greater_than",
              "greater_than_or_equal",
              "less_than",
              "less_than_or_equal",
              "lex_greater_than",
              "lex_greater_than_or_equal",
              "lex_less_than",
              "lex_less_than_or_equal",
              "contains",
              "in_set",
              "deep_equals",
              "deep_not_equals",
              "exists",
              "not_exists"
            ],
            "type": "string"
          },
          "type": "array"
        },
        "anchor_types": {
          "description": "Anchor types emitted by this predicate.",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "content_types": {
          "description": "Content types for predicate output.",
          "items": {
            "type": "string"
          },
          "type": "array"
        },
        "contract_hash": {
          "additionalProperties": false,
          "properties": {
            "algorithm": {
              "enum": [
                "sha256"
              ],
              "type": "string"
            },
            "value": {
              "description": "Lowercase hex digest.",
              "type": "string"
            }
          },
          "required": [
            "algorithm",
            "value"
          ],
          "type": "object"
        },
        "determinism": {
          "description": "Determinism classification for provider predicates.",
          "enum": [
            "deterministic",
            "time_dependent",
            "external"
          ],
          "type": "string"
        },
        "examples": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "description": {
                "description": "Short example description.",
                "type": "string"
              },
              "params": {
                "description": "Example params payload.",
                "type": [
                  "null",
                  "boolean",
                  "number",
                  "string",
                  "array",
                  "object"
                ]
              },
              "result": {
                "description": "Example result value.",
                "type": [
                  "null",
                  "boolean",
                  "number",
                  "string",
                  "array",
                  "object"
                ]
              }
            },
            "required": [
              "description",
              "params",
              "result"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "params_required": {
          "description": "Whether params are required for this predicate.",
          "type": "boolean"
        },
        "params_schema": {
          "description": "JSON schema for predicate params.",
          "type": [
            "null",
            "boolean",
            "number",
            "string",
            "array",
            "object"
          ]
        },
        "predicate": {
          "description": "Predicate name.",
          "type": "string"
        },
        "provider_id": {
          "description": "Provider identifier.",
          "type": "string"
        },
        "result_schema": {
          "description": "JSON schema for predicate result value.",
          "type": [
            "null",
            "boolean",
            "number",
            "string",
            "array",
            "object"
          ]
        }
      },
      "required": [
        "provider_id",
        "predicate",
        "params_required",
        "params_schema",
        "result_schema",
        "allowed_comparators",
        "determinism",
        "anchor_types",
        "content_types",
        "examples",
        "contract_hash"
      ],
      "type": "object"
    }
  },
  {
    "description": "Register a data shape schema for a tenant and namespace.",
    "examples": [
      {
        "description": "Register a data shape schema.",
        "input": {
          "record": {
            "created_at": {
              "kind": "unix_millis",
              "value": 1710000000000
            },
            "description": "Asserted payload schema.",
            "namespace_id": 1,
            "schema": {
              "additionalProperties": false,
              "properties": {
                "deploy_env": {
                  "type": "string"
                }
              },
              "required": [
                "deploy_env"
              ],
              "type": "object"
            },
            "schema_id": "asserted_payload",
            "tenant_id": 1,
            "version": "v1"
          }
        },
        "output": {
          "record": {
            "created_at": {
              "kind": "unix_millis",
              "value": 1710000000000
            },
            "description": "Asserted payload schema.",
            "namespace_id": 1,
            "schema": {
              "additionalProperties": false,
              "properties": {
                "deploy_env": {
                  "type": "string"
                }
              },
              "required": [
                "deploy_env"
              ],
              "type": "object"
            },
            "schema_id": "asserted_payload",
            "tenant_id": 1,
            "version": "v1"
          }
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "record": {
          "additionalProperties": false,
          "properties": {
            "created_at": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            },
            "description": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Optional schema description.",
                  "type": "string"
                }
              ]
            },
            "namespace_id": {
              "description": "Namespace identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "schema": {
              "description": "JSON Schema payload.",
              "type": [
                "null",
                "boolean",
                "number",
                "string",
                "array",
                "object"
              ]
            },
            "schema_id": {
              "description": "Data shape identifier.",
              "type": "string"
            },
            "signing": {
              "additionalProperties": false,
              "properties": {
                "algorithm": {
                  "default": null,
                  "oneOf": [
                    {
                      "type": "null"
                    },
                    {
                      "description": "Signature algorithm label.",
                      "type": "string"
                    }
                  ]
                },
                "key_id": {
                  "description": "Signing key identifier.",
                  "type": "string"
                },
                "signature": {
                  "description": "Schema signature string.",
                  "type": "string"
                }
              },
              "required": [
                "key_id",
                "signature"
              ],
              "type": "object"
            },
            "tenant_id": {
              "description": "Tenant identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "version": {
              "description": "Data shape version identifier.",
              "type": "string"
            }
          },
          "required": [
            "tenant_id",
            "namespace_id",
            "schema_id",
            "version",
            "schema",
            "description",
            "created_at"
          ],
          "type": "object"
        }
      },
      "required": [
        "record"
      ],
      "type": "object"
    },
    "name": "schemas_register",
    "notes": [
      "Schemas are immutable; registering the same version twice fails.",
      "Provide created_at to record when the schema was authored."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "record": {
          "additionalProperties": false,
          "properties": {
            "created_at": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            },
            "description": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Optional schema description.",
                  "type": "string"
                }
              ]
            },
            "namespace_id": {
              "description": "Namespace identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "schema": {
              "description": "JSON Schema payload.",
              "type": [
                "null",
                "boolean",
                "number",
                "string",
                "array",
                "object"
              ]
            },
            "schema_id": {
              "description": "Data shape identifier.",
              "type": "string"
            },
            "signing": {
              "additionalProperties": false,
              "properties": {
                "algorithm": {
                  "default": null,
                  "oneOf": [
                    {
                      "type": "null"
                    },
                    {
                      "description": "Signature algorithm label.",
                      "type": "string"
                    }
                  ]
                },
                "key_id": {
                  "description": "Signing key identifier.",
                  "type": "string"
                },
                "signature": {
                  "description": "Schema signature string.",
                  "type": "string"
                }
              },
              "required": [
                "key_id",
                "signature"
              ],
              "type": "object"
            },
            "tenant_id": {
              "description": "Tenant identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "version": {
              "description": "Data shape version identifier.",
              "type": "string"
            }
          },
          "required": [
            "tenant_id",
            "namespace_id",
            "schema_id",
            "version",
            "schema",
            "description",
            "created_at"
          ],
          "type": "object"
        }
      },
      "required": [
        "record"
      ],
      "type": "object"
    }
  },
  {
    "description": "List registered data shapes for a tenant and namespace.",
    "examples": [
      {
        "description": "List data shapes for a namespace.",
        "input": {
          "cursor": null,
          "limit": 50,
          "namespace_id": 1,
          "tenant_id": 1
        },
        "output": {
          "items": [
            {
              "created_at": {
                "kind": "unix_millis",
                "value": 1710000000000
              },
              "description": "Asserted payload schema.",
              "namespace_id": 1,
              "schema": {
                "additionalProperties": false,
                "properties": {
                  "deploy_env": {
                    "type": "string"
                  }
                },
                "required": [
                  "deploy_env"
                ],
                "type": "object"
              },
              "schema_id": "asserted_payload",
              "tenant_id": 1,
              "version": "v1"
            }
          ],
          "next_token": null
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "cursor": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "description": "Pagination cursor.",
              "type": "string"
            }
          ]
        },
        "limit": {
          "description": "Maximum number of records to return.",
          "maximum": 1000,
          "minimum": 1,
          "type": "integer"
        },
        "namespace_id": {
          "description": "Namespace identifier.",
          "minimum": 1,
          "type": "integer"
        },
        "tenant_id": {
          "description": "Tenant identifier.",
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "tenant_id",
        "namespace_id"
      ],
      "type": "object"
    },
    "name": "schemas_list",
    "notes": [
      "Requires tenant_id and namespace_id.",
      "Supports pagination via cursor + limit."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "items": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "created_at": {
                "oneOf": [
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "unix_millis"
                      },
                      "value": {
                        "type": "integer"
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  },
                  {
                    "additionalProperties": false,
                    "properties": {
                      "kind": {
                        "const": "logical"
                      },
                      "value": {
                        "minimum": 0,
                        "type": "integer"
                      }
                    },
                    "required": [
                      "kind",
                      "value"
                    ],
                    "type": "object"
                  }
                ]
              },
              "description": {
                "oneOf": [
                  {
                    "type": "null"
                  },
                  {
                    "description": "Optional schema description.",
                    "type": "string"
                  }
                ]
              },
              "namespace_id": {
                "description": "Namespace identifier.",
                "minimum": 1,
                "type": "integer"
              },
              "schema": {
                "description": "JSON Schema payload.",
                "type": [
                  "null",
                  "boolean",
                  "number",
                  "string",
                  "array",
                  "object"
                ]
              },
              "schema_id": {
                "description": "Data shape identifier.",
                "type": "string"
              },
              "signing": {
                "additionalProperties": false,
                "properties": {
                  "algorithm": {
                    "default": null,
                    "oneOf": [
                      {
                        "type": "null"
                      },
                      {
                        "description": "Signature algorithm label.",
                        "type": "string"
                      }
                    ]
                  },
                  "key_id": {
                    "description": "Signing key identifier.",
                    "type": "string"
                  },
                  "signature": {
                    "description": "Schema signature string.",
                    "type": "string"
                  }
                },
                "required": [
                  "key_id",
                  "signature"
                ],
                "type": "object"
              },
              "tenant_id": {
                "description": "Tenant identifier.",
                "minimum": 1,
                "type": "integer"
              },
              "version": {
                "description": "Data shape version identifier.",
                "type": "string"
              }
            },
            "required": [
              "tenant_id",
              "namespace_id",
              "schema_id",
              "version",
              "schema",
              "description",
              "created_at"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "next_token": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "description": "Pagination token for the next page.",
              "type": "string"
            }
          ]
        }
      },
      "required": [
        "items",
        "next_token"
      ],
      "type": "object"
    }
  },
  {
    "description": "Fetch a specific data shape by identifier and version.",
    "examples": [
      {
        "description": "Fetch a data shape by identifier and version.",
        "input": {
          "namespace_id": 1,
          "schema_id": "asserted_payload",
          "tenant_id": 1,
          "version": "v1"
        },
        "output": {
          "record": {
            "created_at": {
              "kind": "unix_millis",
              "value": 1710000000000
            },
            "description": "Asserted payload schema.",
            "namespace_id": 1,
            "schema": {
              "additionalProperties": false,
              "properties": {
                "deploy_env": {
                  "type": "string"
                }
              },
              "required": [
                "deploy_env"
              ],
              "type": "object"
            },
            "schema_id": "asserted_payload",
            "tenant_id": 1,
            "version": "v1"
          }
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "namespace_id": {
          "description": "Namespace identifier.",
          "minimum": 1,
          "type": "integer"
        },
        "schema_id": {
          "description": "Data shape identifier.",
          "type": "string"
        },
        "tenant_id": {
          "description": "Tenant identifier.",
          "minimum": 1,
          "type": "integer"
        },
        "version": {
          "description": "Data shape version identifier.",
          "type": "string"
        }
      },
      "required": [
        "tenant_id",
        "namespace_id",
        "schema_id",
        "version"
      ],
      "type": "object"
    },
    "name": "schemas_get",
    "notes": [
      "Requires tenant_id, namespace_id, schema_id, and version.",
      "Fails closed when schema is missing."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "record": {
          "additionalProperties": false,
          "properties": {
            "created_at": {
              "oneOf": [
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "unix_millis"
                    },
                    "value": {
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                },
                {
                  "additionalProperties": false,
                  "properties": {
                    "kind": {
                      "const": "logical"
                    },
                    "value": {
                      "minimum": 0,
                      "type": "integer"
                    }
                  },
                  "required": [
                    "kind",
                    "value"
                  ],
                  "type": "object"
                }
              ]
            },
            "description": {
              "oneOf": [
                {
                  "type": "null"
                },
                {
                  "description": "Optional schema description.",
                  "type": "string"
                }
              ]
            },
            "namespace_id": {
              "description": "Namespace identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "schema": {
              "description": "JSON Schema payload.",
              "type": [
                "null",
                "boolean",
                "number",
                "string",
                "array",
                "object"
              ]
            },
            "schema_id": {
              "description": "Data shape identifier.",
              "type": "string"
            },
            "signing": {
              "additionalProperties": false,
              "properties": {
                "algorithm": {
                  "default": null,
                  "oneOf": [
                    {
                      "type": "null"
                    },
                    {
                      "description": "Signature algorithm label.",
                      "type": "string"
                    }
                  ]
                },
                "key_id": {
                  "description": "Signing key identifier.",
                  "type": "string"
                },
                "signature": {
                  "description": "Schema signature string.",
                  "type": "string"
                }
              },
              "required": [
                "key_id",
                "signature"
              ],
              "type": "object"
            },
            "tenant_id": {
              "description": "Tenant identifier.",
              "minimum": 1,
              "type": "integer"
            },
            "version": {
              "description": "Data shape version identifier.",
              "type": "string"
            }
          },
          "required": [
            "tenant_id",
            "namespace_id",
            "schema_id",
            "version",
            "schema",
            "description",
            "created_at"
          ],
          "type": "object"
        }
      },
      "required": [
        "record"
      ],
      "type": "object"
    }
  },
  {
    "description": "List registered scenarios for a tenant and namespace.",
    "examples": [
      {
        "description": "List scenarios for a namespace.",
        "input": {
          "cursor": null,
          "limit": 50,
          "namespace_id": 1,
          "tenant_id": 1
        },
        "output": {
          "items": [
            {
              "namespace_id": 1,
              "scenario_id": "example-scenario",
              "spec_hash": {
                "algorithm": "sha256",
                "value": "5c3a5b6bce0f4a2c9e22c4fa6a1e6d8d90b0f2dfed1b7f1e9b3d3b3d1f0c9b21"
              }
            }
          ],
          "next_token": null
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "cursor": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "description": "Pagination cursor.",
              "type": "string"
            }
          ]
        },
        "limit": {
          "description": "Maximum number of records to return.",
          "maximum": 1000,
          "minimum": 1,
          "type": "integer"
        },
        "namespace_id": {
          "description": "Namespace identifier.",
          "minimum": 1,
          "type": "integer"
        },
        "tenant_id": {
          "description": "Tenant identifier.",
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "tenant_id",
        "namespace_id"
      ],
      "type": "object"
    },
    "name": "scenarios_list",
    "notes": [
      "Requires tenant_id and namespace_id.",
      "Returns scenario identifiers and hashes."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "items": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "namespace_id": {
                "description": "Namespace identifier.",
                "minimum": 1,
                "type": "integer"
              },
              "scenario_id": {
                "description": "Scenario identifier.",
                "type": "string"
              },
              "spec_hash": {
                "additionalProperties": false,
                "properties": {
                  "algorithm": {
                    "enum": [
                      "sha256"
                    ],
                    "type": "string"
                  },
                  "value": {
                    "description": "Lowercase hex digest.",
                    "type": "string"
                  }
                },
                "required": [
                  "algorithm",
                  "value"
                ],
                "type": "object"
              }
            },
            "required": [
              "scenario_id",
              "namespace_id",
              "spec_hash"
            ],
            "type": "object"
          },
          "type": "array"
        },
        "next_token": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "description": "Pagination token for the next page.",
              "type": "string"
            }
          ]
        }
      },
      "required": [
        "items",
        "next_token"
      ],
      "type": "object"
    }
  },
  {
    "description": "Evaluate a scenario against asserted data without mutating state.",
    "examples": [
      {
        "description": "Precheck a scenario with asserted data.",
        "input": {
          "data_shape": {
            "schema_id": "asserted_payload",
            "version": "v1"
          },
          "namespace_id": 1,
          "payload": {
            "deploy_env": "production"
          },
          "scenario_id": "example-scenario",
          "spec": null,
          "stage_id": null,
          "tenant_id": 1
        },
        "output": {
          "decision": {
            "kind": "hold",
            "summary": {
              "policy_tags": [],
              "retry_hint": "await_evidence",
              "status": "hold",
              "unmet_gates": [
                "ready"
              ]
            }
          },
          "gate_evaluations": []
        }
      }
    ],
    "input_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "data_shape": {
          "additionalProperties": false,
          "properties": {
            "schema_id": {
              "description": "Data shape identifier.",
              "type": "string"
            },
            "version": {
              "description": "Data shape version identifier.",
              "type": "string"
            }
          },
          "required": [
            "schema_id",
            "version"
          ],
          "type": "object"
        },
        "namespace_id": {
          "description": "Namespace identifier.",
          "minimum": 1,
          "type": "integer"
        },
        "payload": {
          "description": "Asserted data payload.",
          "type": [
            "null",
            "boolean",
            "number",
            "string",
            "array",
            "object"
          ]
        },
        "scenario_id": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "description": "Scenario identifier.",
              "type": "string"
            }
          ]
        },
        "spec": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "$ref": "decision-gate://contract/schemas/scenario.schema.json"
            }
          ]
        },
        "stage_id": {
          "oneOf": [
            {
              "type": "null"
            },
            {
              "description": "Stage identifier override.",
              "type": "string"
            }
          ]
        },
        "tenant_id": {
          "description": "Tenant identifier.",
          "minimum": 1,
          "type": "integer"
        }
      },
      "required": [
        "tenant_id",
        "namespace_id",
        "data_shape",
        "payload"
      ],
      "type": "object"
    },
    "name": "precheck",
    "notes": [
      "Validates asserted data against a registered shape.",
      "Does not mutate run state; intended for simulation."
    ],
    "output_schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "additionalProperties": false,
      "properties": {
        "decision": {
          "oneOf": [
            {
              "additionalProperties": false,
              "properties": {
                "kind": {
                  "const": "start"
                },
                "stage_id": {
                  "description": "Initial stage identifier.",
                  "type": "string"
                }
              },
              "required": [
                "kind",
                "stage_id"
              ],
              "type": "object"
            },
            {
              "additionalProperties": false,
              "properties": {
                "kind": {
                  "const": "complete"
                },
                "stage_id": {
                  "description": "Terminal stage identifier.",
                  "type": "string"
                }
              },
              "required": [
                "kind",
                "stage_id"
              ],
              "type": "object"
            },
            {
              "additionalProperties": false,
              "properties": {
                "from_stage": {
                  "description": "Previous stage identifier.",
                  "type": "string"
                },
                "kind": {
                  "const": "advance"
                },
                "timeout": {
                  "type": "boolean"
                },
                "to_stage": {
                  "description": "Next stage identifier.",
                  "type": "string"
                }
              },
              "required": [
                "kind",
                "from_stage",
                "to_stage",
                "timeout"
              ],
              "type": "object"
            },
            {
              "additionalProperties": false,
              "properties": {
                "kind": {
                  "const": "hold"
                },
                "summary": {
                  "additionalProperties": false,
                  "properties": {
                    "policy_tags": {
                      "description": "Policy tags applied to the summary.",
                      "items": {
                        "type": "string"
                      },
                      "type": "array"
                    },
                    "retry_hint": {
                      "oneOf": [
                        {
                          "type": "null"
                        },
                        {
                          "description": "Optional retry hint.",
                          "type": "string"
                        }
                      ]
                    },
                    "status": {
                      "description": "Summary status.",
                      "type": "string"
                    },
                    "unmet_gates": {
                      "items": {
                        "description": "Gate identifier.",
                        "type": "string"
                      },
                      "type": "array"
                    }
                  },
                  "required": [
                    "status",
                    "unmet_gates",
                    "retry_hint",
                    "policy_tags"
                  ],
                  "type": "object"
                }
              },
              "required": [
                "kind",
                "summary"
              ],
              "type": "object"
            },
            {
              "additionalProperties": false,
              "properties": {
                "kind": {
                  "const": "fail"
                },
                "reason": {
                  "description": "Failure reason.",
                  "type": "string"
                }
              },
              "required": [
                "kind",
                "reason"
              ],
              "type": "object"
            }
          ]
        },
        "gate_evaluations": {
          "items": {
            "additionalProperties": false,
            "properties": {
              "gate_id": {
                "description": "Gate identifier.",
                "type": "string"
              },
              "status": {
                "description": "Tri-state evaluation result.",
                "enum": [
                  "True",
                  "False",
                  "Unknown"
                ],
                "type": "string"
              },
              "trace": {
                "items": {
                  "additionalProperties": false,
                  "properties": {
                    "predicate": {
                      "description": "Predicate identifier.",
                      "type": "string"
                    },
                    "status": {
                      "description": "Tri-state evaluation result.",
                      "enum": [
                        "True",
                        "False",
                        "Unknown"
                      ],
                      "type": "string"
                    }
                  },
                  "required": [
                    "predicate",
                    "status"
                  ],
                  "type": "object"
                },
                "type": "array"
              }
            },
            "required": [
              "gate_id",
              "status",
              "trace"
            ],
            "type": "object"
          },
          "type": "array"
        }
      },
      "required": [
        "decision",
        "gate_evaluations"
      ],
      "type": "object"
    }
  }
]
