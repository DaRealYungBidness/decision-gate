# Decision Gate System-Test Gaps
# Tracks missing coverage and acceptance criteria.

[[gaps]]
id = "asc-auth-mapping-matrix"
title = "AssetCore auth mapping matrix coverage"
priority = "P1"
category = "security"
status = "closed"
acceptance_criteria = "Define the ASC role/policy_class mapping and add system-tests that validate each permission pathway."
notes = "Implemented in system-tests/tests/suites/auth_matrix.rs with auth proxy mapping; integration contract updated."

[[gaps]]
id = "asc-determinism-replay"
title = "Determinism across identical AssetCore state and replay"
priority = "P1"
category = "reliability"
status = "closed"
acceptance_criteria = "Execute identical ASC fixture runs and assert identical decisions plus runpack hashes."
notes = "Implemented in system-tests/tests/suites/determinism.rs using AssetCore fixture map runs."

[[gaps]]
id = "multi-transport-parity"
title = "Multi-transport parity across MCP/CLI/HTTP"
priority = "P2"
category = "mcp_transport"
status = "closed"
acceptance_criteria = "Run a single scenario via HTTP, stdio, and CLI and compare decisions/runpack artifacts."
notes = "Implemented in system-tests/tests/suites/transport_parity.rs using HTTP, stdio, and CLI interop."

[[gaps]]
id = "security-fuzzing-anchors"
title = "Fuzz/property tests for malformed inputs and anchor injection"
priority = "P2"
category = "security"
status = "closed"
acceptance_criteria = "Add fuzz/property coverage for malformed evidence payloads, oversize anchors, and injection attempts."
notes = "Implemented deterministic fuzz cases in system-tests/tests/suites/anchor_fuzz.rs (malformed JSON, missing fields, wrong types, oversized responses)."

[[gaps]]
id = "registry-acl-matrix-system"
title = "Schema registry ACL matrix coverage (system-tests)"
priority = "P1"
category = "security"
status = "closed"
acceptance_criteria = "System-tests exercise schemas_register/list/get for every built-in role + policy_class combination, including deny-by-default when principals are absent."
notes = "Implemented in system-tests/tests/suites/registry_acl.rs (registry_acl_builtin_matrix)."

[[gaps]]
id = "registry-acl-principal-subject-mapping"
title = "Principal subject mapping coverage (stdio/loopback/bearer/mTLS)"
priority = "P1"
category = "security"
status = "closed"
acceptance_criteria = "System-tests verify principals resolve correctly for stdio, loopback HTTP, bearer token fingerprint, and mTLS subject headers, and that ACL decisions follow."
notes = "Implemented in system-tests/tests/suites/registry_acl.rs (registry_acl_principal_subject_mapping)."

[[gaps]]
id = "registry-acl-signing-required"
title = "Schema signing requirement enforcement (system-tests)"
priority = "P1"
category = "security"
status = "closed"
acceptance_criteria = "When schema_registry.acl.require_signing = true, schemas_register rejects missing/empty signing, accepts valid signing, and list/get preserves metadata (memory + sqlite)."
notes = "Implemented in system-tests/tests/suites/registry_acl.rs (registry_acl_signing_required_memory_and_sqlite)."

[[gaps]]
id = "namespace-default-allowlist-system"
title = "Default namespace allowlist enforcement (system-tests)"
priority = "P1"
category = "security"
status = "closed"
acceptance_criteria = "System-tests prove default namespace is allowed only for allowlisted tenants and denied otherwise across tool calls."
notes = "Implemented in system-tests/tests/suites/namespace_defaults.rs (default_namespace_allowlist_enforced)."

[[gaps]]
id = "dev-permissive-assetcore-reject-runtime"
title = "Dev-permissive rejected with AssetCore authority (system-tests)"
priority = "P1"
category = "security"
status = "closed"
acceptance_criteria = "Server fails to start (or rejects config) when dev.permissive=true and namespace.authority.mode=assetcore_http; verify error path and audit behavior."
notes = "Implemented in system-tests/tests/suites/config_validation.rs (dev_permissive_assetcore_rejected)."

[[gaps]]
id = "runpack-security-context-export"
title = "Runpack export includes security context"
priority = "P2"
category = "audit"
status = "closed"
acceptance_criteria = "System-tests verify runpack_export manifest includes security.dev_permissive, security.namespace_authority, and security.namespace_mapping_mode when applicable."
notes = "Implemented in system-tests/tests/suites/runpack.rs (runpack_export_includes_security_context)."

[[gaps]]
id = "audit-events-registry-security"
title = "Registry + security audit event validation"
priority = "P1"
category = "audit"
status = "closed"
acceptance_criteria = "System-tests capture audit sinks and assert registry_audit and security_audit events emit required fields and allow/deny decisions."
notes = "Implemented in system-tests/tests/suites/audit_registry.rs (registry_security_audit_events)."
