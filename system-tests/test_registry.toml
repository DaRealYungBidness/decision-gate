# Decision Gate System-Test Registry
# Maps system-tests to categories and priorities.
# Used by: scripts/test_runner.py, scripts/coverage_report.py

# =============================================================================
# Test Categories
# =============================================================================

[categories]
smoke = { description = "Fast sanity checks", quick = true }
functional = { description = "Feature validation and workflows", quick = true }
providers = { description = "Evidence providers and federation", quick = true }
mcp_transport = { description = "MCP transport validation", quick = true }
runpack = { description = "Runpack export/verify integrity", quick = true }
reliability = { description = "Determinism and idempotency", quick = false }
security = { description = "Disclosure and policy enforcement", quick = true }
contract = { description = "Schema and contract conformance", quick = true }
operations = { description = "Startup and configuration validation", quick = false }
performance = { description = "Performance smoke checks", quick = false }

# =============================================================================
# P0: Must Pass
# =============================================================================

[[tests]]
name = "smoke_define_start_next_status"
category = "smoke"
priority = "P0"
description = "Define scenario, start run, advance, and check status over HTTP MCP."
files = ["system-tests/tests/suites/smoke.rs"]
run_command = "cargo test -p system-tests --features system-tests --test smoke -- --exact smoke_define_start_next_status"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 10

[[tests]]
name = "runpack_export_verify_happy_path"
category = "runpack"
priority = "P0"
description = "Export a runpack and verify integrity over MCP tools."
files = ["system-tests/tests/suites/runpack.rs"]
run_command = "cargo test -p system-tests --features system-tests --test runpack -- --exact runpack_export_verify_happy_path"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "runpack/"]
estimated_runtime_sec = 15

[[tests]]
name = "schema_conformance_all_tools"
category = "contract"
priority = "P0"
description = "Validate MCP tool inputs/outputs against contract schemas."
files = ["system-tests/tests/suites/contract.rs"]
run_command = "cargo test -p system-tests --features system-tests --test contract -- --exact schema_conformance_all_tools"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 20

[[tests]]
name = "evidence_redaction_default"
category = "security"
priority = "P0"
description = "Raw evidence values are redacted by default in evidence_query."
files = ["system-tests/tests/suites/security.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact evidence_redaction_default"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "http_bearer_token_required"
category = "security"
priority = "P0"
description = "HTTP MCP tools require bearer authentication when configured."
files = ["system-tests/tests/suites/mcp_auth.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact http_bearer_token_required"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "http_tool_allowlist_enforced"
category = "security"
priority = "P0"
description = "Tool allowlist denies unauthorized MCP tool calls."
files = ["system-tests/tests/suites/mcp_auth.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact http_tool_allowlist_enforced"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "http_mtls_subject_required"
category = "security"
priority = "P0"
description = "HTTP MCP tools require mTLS subject header when configured."
files = ["system-tests/tests/suites/mcp_auth.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact http_mtls_subject_required"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "sse_bearer_token_required"
category = "security"
priority = "P0"
description = "SSE MCP transport enforces bearer authentication."
files = ["system-tests/tests/suites/mcp_auth.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact sse_bearer_token_required"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "http_rate_limit_enforced"
category = "operations"
priority = "P0"
description = "HTTP MCP rate limiting rejects excess requests."
files = ["system-tests/tests/suites/mcp_hardening.rs"]
run_command = "cargo test -p system-tests --features system-tests --test operations -- --exact http_rate_limit_enforced"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "http_tls_handshake_success"
category = "operations"
priority = "P0"
description = "HTTPS MCP transport succeeds with configured TLS."
files = ["system-tests/tests/suites/mcp_hardening.rs"]
run_command = "cargo test -p system-tests --features system-tests --test operations -- --exact http_tls_handshake_success"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "http_mtls_client_cert_required"
category = "security"
priority = "P0"
description = "HTTPS MCP transport enforces client certificates when configured."
files = ["system-tests/tests/suites/mcp_hardening.rs"]
run_command = "cargo test -p system-tests --features system-tests --test operations -- --exact http_mtls_client_cert_required"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 10

[[tests]]
name = "http_audit_log_written"
category = "operations"
priority = "P0"
description = "HTTP MCP audit logging writes structured JSON lines."
files = ["system-tests/tests/suites/mcp_hardening.rs"]
run_command = "cargo test -p system-tests --features system-tests --test operations -- --exact http_audit_log_written"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "audit.log"]
estimated_runtime_sec = 8

[[tests]]
name = "idempotent_trigger"
category = "reliability"
priority = "P0"
description = "Duplicate trigger IDs do not create duplicate decisions."
files = ["system-tests/tests/suites/reliability.rs"]
run_command = "cargo test -p system-tests --features system-tests --test reliability -- --exact idempotent_trigger"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "runpack/"]
estimated_runtime_sec = 15

[[tests]]
name = "idempotent_submission"
category = "reliability"
priority = "P0"
description = "Duplicate submission IDs return the existing record; conflicts fail closed."
files = ["system-tests/tests/suites/reliability.rs"]
run_command = "cargo test -p system-tests --features system-tests --test reliability -- --exact idempotent_submission"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "runpack/"]
estimated_runtime_sec = 15

[[tests]]
name = "provider_time_after"
category = "providers"
priority = "P0"
description = "Time provider predicate evaluates correctly."
files = ["system-tests/tests/suites/providers.rs"]
run_command = "cargo test -p system-tests --features system-tests --test providers -- --exact provider_time_after"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

# =============================================================================
# P1: High Value
# =============================================================================

[[tests]]
name = "http_transport_end_to_end"
category = "mcp_transport"
priority = "P1"
description = "HTTP JSON-RPC transport handles tools/list and tools/call."
files = ["system-tests/tests/suites/mcp_transport.rs"]
run_command = "cargo test -p system-tests --features system-tests --test mcp_transport -- --exact http_transport_end_to_end"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "smoke_schema_register_precheck"
category = "smoke"
priority = "P1"
description = "Register a schema and precheck asserted payloads."
files = ["system-tests/tests/suites/smoke.rs"]
run_command = "cargo test -p system-tests --features system-tests --test smoke -- --exact smoke_schema_register_precheck"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 10

[[tests]]
name = "smoke_schema_registry_max_entries_enforced"
category = "smoke"
priority = "P1"
description = "Schema registry max entries limit is enforced."
files = ["system-tests/tests/suites/smoke.rs"]
run_command = "cargo test -p system-tests --features system-tests --test smoke -- --exact smoke_schema_registry_max_entries_enforced"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "smoke_precheck_rejects_invalid_payload"
category = "smoke"
priority = "P1"
description = "Precheck rejects payloads that fail schema validation."
files = ["system-tests/tests/suites/smoke.rs"]
run_command = "cargo test -p system-tests --features system-tests --test smoke -- --exact smoke_precheck_rejects_invalid_payload"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "smoke_precheck_respects_trust_lane_default"
category = "smoke"
priority = "P1"
description = "Precheck respects default trust lane when asserted evidence is missing."
files = ["system-tests/tests/suites/smoke.rs"]
run_command = "cargo test -p system-tests --features system-tests --test smoke -- --exact smoke_precheck_respects_trust_lane_default"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "strict_validation_precheck_rejects_comparator_mismatch"
category = "functional"
priority = "P1"
description = "Precheck rejects comparator/schema mismatches under strict validation."
files = ["system-tests/tests/suites/validation.rs"]
run_command = "cargo test -p system-tests --features system-tests --test functional -- --exact strict_validation_precheck_rejects_comparator_mismatch"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "strict_validation_precheck_allows_permissive"
category = "functional"
priority = "P1"
description = "Precheck proceeds when strict validation is disabled with allow_permissive."
files = ["system-tests/tests/suites/validation.rs"]
run_command = "cargo test -p system-tests --features system-tests --test functional -- --exact strict_validation_precheck_allows_permissive"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "strict_validation_rejects_disabled_comparators"
category = "functional"
priority = "P1"
description = "Scenario define rejects lex/deep comparators when disabled by config."
files = ["system-tests/tests/suites/validation.rs"]
run_command = "cargo test -p system-tests --features system-tests --test functional -- --exact strict_validation_rejects_disabled_comparators"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "strict_validation_allows_enabled_comparators"
category = "functional"
priority = "P1"
description = "Scenario define accepts lex/deep comparators when enabled."
files = ["system-tests/tests/suites/validation.rs"]
run_command = "cargo test -p system-tests --features system-tests --test functional -- --exact strict_validation_allows_enabled_comparators"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "strict_validation_rejects_in_set_non_array"
category = "functional"
priority = "P1"
description = "Scenario define rejects in_set when expected is not an array."
files = ["system-tests/tests/suites/validation.rs"]
run_command = "cargo test -p system-tests --features system-tests --test functional -- --exact strict_validation_rejects_in_set_non_array"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "strict_validation_precheck_allows_union_contains"
category = "functional"
priority = "P1"
description = "Precheck accepts contains comparator with string/null union schemas."
files = ["system-tests/tests/suites/validation.rs"]
run_command = "cargo test -p system-tests --features system-tests --test functional -- --exact strict_validation_precheck_allows_union_contains"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "json_evidence_playbook_templates_pass"
category = "functional"
priority = "P1"
description = "JSON evidence playbook templates evaluate via live run + JSON provider."
files = ["system-tests/tests/suites/json_evidence.rs"]
run_command = "cargo test -p system-tests --features system-tests --test functional -- --exact json_evidence::json_evidence_playbook_templates_pass"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 12

[[tests]]
name = "llm_native_precheck_payload_flow"
category = "functional"
priority = "P1"
description = "LLM-native precheck payload flow evaluates asserted evidence."
files = ["system-tests/tests/suites/json_evidence.rs"]
run_command = "cargo test -p system-tests --features system-tests --test functional -- --exact json_evidence::llm_native_precheck_payload_flow"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 10

[[tests]]
name = "http_tool_allowlist_blocks_precheck"
category = "security"
priority = "P1"
description = "Tool allowlist blocks precheck when not explicitly allowed."
files = ["system-tests/tests/suites/mcp_auth.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact http_tool_allowlist_blocks_precheck"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "federated_provider_echo"
category = "providers"
priority = "P1"
description = "External MCP provider integration via HTTP."
files = ["system-tests/tests/suites/providers.rs"]
run_command = "cargo test -p system-tests --features system-tests --test providers -- --exact federated_provider_echo"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 12

[[tests]]
name = "federated_provider_timeout_enforced"
category = "providers"
priority = "P1"
description = "External MCP provider HTTP timeouts fail closed."
files = ["system-tests/tests/suites/providers.rs"]
run_command = "cargo test -p system-tests --features system-tests --test providers -- --exact federated_provider_timeout_enforced"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "echo_provider_contract.json"]
estimated_runtime_sec = 12

[[tests]]
name = "json_provider_missing_jsonpath_returns_error_metadata"
category = "providers"
priority = "P1"
description = "JSON provider returns structured error metadata for missing JSONPath."
files = ["system-tests/tests/suites/providers.rs"]
run_command = "cargo test -p system-tests --features system-tests --test providers -- --exact json_provider_missing_jsonpath_returns_error_metadata"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "json_provider_contains_array_succeeds"
category = "providers"
priority = "P1"
description = "JSON provider path + contains comparator evaluates end-to-end."
files = ["system-tests/tests/suites/providers.rs"]
run_command = "cargo test -p system-tests --features system-tests --test providers -- --exact json_provider_contains_array_succeeds"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 10

[[tests]]
name = "http_provider_discovery_tools"
category = "contract"
priority = "P1"
description = "HTTP MCP exposes provider contract/schema discovery tools."
files = ["system-tests/tests/suites/provider_discovery.rs"]
run_command = "cargo test -p system-tests --features system-tests --test contract -- --exact http_provider_discovery_tools"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 10

[[tests]]
name = "stdio_provider_discovery_tools"
category = "contract"
priority = "P1"
description = "Stdio MCP exposes provider contract/schema discovery tools."
files = ["system-tests/tests/suites/provider_discovery.rs"]
run_command = "cargo test -p system-tests --features system-tests --test contract -- --exact stdio_provider_discovery_tools"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "mcp.stderr.log"]
estimated_runtime_sec = 12

[[tests]]
name = "assetcore_interop_fixtures"
category = "providers"
priority = "P1"
description = "AssetCore interop fixture map executes via federated provider."
files = ["system-tests/tests/suites/providers.rs"]
run_command = "cargo test -p system-tests --features system-tests --test providers -- --exact assetcore_interop_fixtures"
artifacts = [
  "summary.json",
  "summary.md",
  "tool_transcript.json",
  "interop_spec.json",
  "interop_run_config.json",
  "interop_trigger.json",
  "interop_fixture_map.json",
  "interop_status.json",
  "interop_decision.json",
]
estimated_runtime_sec = 15

[[tests]]
name = "assetcore_anchor_missing_fails_closed"
category = "providers"
priority = "P1"
description = "Missing AssetCore anchors fail closed for federated provider evidence."
files = ["system-tests/tests/suites/assetcore_integration.rs"]
run_command = "cargo test -p system-tests --features system-tests --test providers -- --exact assetcore_anchor_missing_fails_closed"
artifacts = [
  "summary.json",
  "summary.md",
  "assetcore_spec.json",
  "tool_transcript.json",
]
estimated_runtime_sec = 12

[[tests]]
name = "assetcore_correlation_id_passthrough"
category = "providers"
priority = "P1"
description = "Correlation IDs are preserved for AssetCore evidence queries."
files = ["system-tests/tests/suites/assetcore_integration.rs"]
run_command = "cargo test -p system-tests --features system-tests --test providers -- --exact assetcore_correlation_id_passthrough"
artifacts = [
  "summary.json",
  "summary.md",
  "provider_requests.json",
  "tool_transcript.json",
]
estimated_runtime_sec = 12

[[tests]]
name = "namespace_authority_allows_known_namespace"
category = "security"
priority = "P1"
description = "AssetCore namespace authority allows known namespaces."
files = ["system-tests/tests/suites/assetcore_integration.rs"]
run_command = "cargo test -p system-tests --features system-tests --test providers -- --exact namespace_authority_allows_known_namespace"
artifacts = [
  "summary.json",
  "summary.md",
  "namespace_requests.json",
  "tool_transcript.json",
]
estimated_runtime_sec = 10

[[tests]]
name = "namespace_authority_denies_unknown_namespace"
category = "security"
priority = "P1"
description = "AssetCore namespace authority denies unknown namespaces."
files = ["system-tests/tests/suites/assetcore_integration.rs"]
run_command = "cargo test -p system-tests --features system-tests --test providers -- --exact namespace_authority_denies_unknown_namespace"
artifacts = [
  "summary.json",
  "summary.md",
  "namespace_requests.json",
  "tool_transcript.json",
]
estimated_runtime_sec = 10

[[tests]]
name = "namespace_mismatch_rejected"
category = "security"
priority = "P1"
description = "Namespace mismatch between scenario spec and run config is rejected."
files = ["system-tests/tests/suites/assetcore_integration.rs"]
run_command = "cargo test -p system-tests --features system-tests --test providers -- --exact namespace_mismatch_rejected"
artifacts = [
  "summary.json",
  "summary.md",
  "tool_transcript.json",
]
estimated_runtime_sec = 8

[[tests]]
name = "packet_disclosure_visibility"
category = "security"
priority = "P1"
description = "Packet visibility labels and policy tags persist into envelopes."
files = ["system-tests/tests/suites/security.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact packet_disclosure_visibility"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "strict_mode_rejects_default_namespace"
category = "security"
priority = "P1"
description = "Strict mode rejects the default namespace without explicit allow."
files = ["system-tests/tests/suites/security.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact strict_mode_rejects_default_namespace"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "dev_permissive_emits_warning"
category = "operations"
priority = "P1"
description = "Dev-permissive mode emits an explicit startup warning."
files = ["system-tests/tests/suites/operations.rs"]
run_command = "cargo test -p system-tests --features system-tests --test operations -- --exact dev_permissive_emits_warning"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "mcp.stderr.log"]
estimated_runtime_sec = 8

[[tests]]
name = "precheck_audit_hash_only"
category = "operations"
priority = "P1"
description = "Precheck emits hash-only audit events by default."
files = ["system-tests/tests/suites/operations.rs"]
run_command = "cargo test -p system-tests --features system-tests --test operations -- --exact precheck_audit_hash_only"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "mcp.stderr.log"]
estimated_runtime_sec = 8

[[tests]]
name = "policy_denies_dispatch_targets"
category = "security"
priority = "P1"
description = "Static policy engine denies disclosure and fails the run."
files = ["system-tests/tests/suites/security.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact policy_denies_dispatch_targets"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "policy_state.json"]
estimated_runtime_sec = 10

[[tests]]
name = "policy_error_fails_closed"
category = "security"
priority = "P1"
description = "Static policy engine error fails closed with explicit reason."
files = ["system-tests/tests/suites/security.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact policy_error_fails_closed"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "policy_state.json"]
estimated_runtime_sec = 10

[[tests]]
name = "timeout_policies"
category = "reliability"
priority = "P1"
description = "Timeout policies fail, advance_with_flag, and alternate_branch behave as specified."
files = ["system-tests/tests/suites/reliability.rs"]
run_command = "cargo test -p system-tests --features system-tests --test reliability -- --exact timeout_policies"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 20

[[tests]]
name = "sqlite_run_state_persists_across_restart"
category = "reliability"
priority = "P1"
description = "SQLite run state persists across MCP server restarts."
files = ["system-tests/tests/suites/store_persistence.rs"]
run_command = "cargo test -p system-tests --features system-tests --test reliability -- --exact sqlite_run_state_persists_across_restart"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 20

[[tests]]
name = "sqlite_requires_redefine_after_restart"
category = "reliability"
priority = "P1"
description = "Run state requires scenario re-define after restart before status queries."
files = ["system-tests/tests/suites/store_persistence.rs"]
run_command = "cargo test -p system-tests --features system-tests --test reliability -- --exact sqlite_requires_redefine_after_restart"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 20

[[tests]]
name = "runpack_tamper_detection"
category = "runpack"
priority = "P1"
description = "Tampered runpack artifacts fail verification."
files = ["system-tests/tests/suites/runpack.rs"]
run_command = "cargo test -p system-tests --features system-tests --test runpack -- --exact runpack_tamper_detection"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "runpack/"]
estimated_runtime_sec = 15

[[tests]]
name = "asc_auth_mapping_matrix"
category = "security"
priority = "P1"
description = "ASC role/policy_class auth mapping is enforced via the integration proxy."
files = ["system-tests/tests/suites/auth_matrix.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact asc_auth_mapping_matrix"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "runpack/"]
estimated_runtime_sec = 20

[[tests]]
name = "assetcore_determinism_replay"
category = "reliability"
priority = "P1"
description = "Identical AssetCore fixtures yield identical decisions and runpack hashes."
files = ["system-tests/tests/suites/determinism.rs"]
run_command = "cargo test -p system-tests --features system-tests --test reliability -- --exact assetcore_determinism_replay"
artifacts = [
  "summary.json",
  "summary.md",
  "tool_transcript.json",
  "run_a_manifest.json",
  "run_b_manifest.json",
  "runpack/",
]
estimated_runtime_sec = 20

[[tests]]
name = "registry_acl_builtin_matrix"
category = "security"
priority = "P1"
description = "Builtin schema registry ACL matrix is enforced across roles."
files = ["system-tests/tests/suites/registry_acl.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact registry_acl_builtin_matrix"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 15

[[tests]]
name = "registry_acl_principal_subject_mapping"
category = "security"
priority = "P1"
description = "Registry ACL principal mapping respects stdio/loopback/bearer/mTLS subjects."
files = ["system-tests/tests/suites/registry_acl.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact registry_acl_principal_subject_mapping"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "stdio-allowed.stderr.log", "stdio-denied.stderr.log"]
estimated_runtime_sec = 20

[[tests]]
name = "registry_acl_signing_required_memory_and_sqlite"
category = "security"
priority = "P1"
description = "Schema registry requires signing metadata for memory + sqlite backends."
files = ["system-tests/tests/suites/registry_acl.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact registry_acl_signing_required_memory_and_sqlite"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 12

[[tests]]
name = "default_namespace_allowlist_enforced"
category = "security"
priority = "P1"
description = "Default namespace allowlist enforces tenant scoping."
files = ["system-tests/tests/suites/namespace_defaults.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact default_namespace_allowlist_enforced"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 8

[[tests]]
name = "dev_permissive_assetcore_rejected"
category = "security"
priority = "P1"
description = "Dev-permissive mode is rejected with AssetCore namespace authority."
files = ["system-tests/tests/suites/config_validation.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact dev_permissive_assetcore_rejected"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 5

[[tests]]
name = "registry_security_audit_events"
category = "security"
priority = "P1"
description = "Registry + security audit events emit required fields for allow/deny."
files = ["system-tests/tests/suites/audit_registry.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact registry_security_audit_events"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "audit.log"]
estimated_runtime_sec = 10

# =============================================================================
# P2: Non-Gated / Extended Coverage
# =============================================================================

[[tests]]
name = "stdio_transport_end_to_end"
category = "mcp_transport"
priority = "P2"
description = "Stdio JSON-RPC transport handles tools/list and tools/call."
files = ["system-tests/tests/suites/mcp_transport.rs"]
run_command = "cargo test -p system-tests --features system-tests --test mcp_transport -- --exact stdio_transport_end_to_end"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "mcp.stderr.log"]
estimated_runtime_sec = 12

[[tests]]
name = "multi_transport_parity"
category = "mcp_transport"
priority = "P2"
description = "HTTP, stdio, and CLI interop produce identical decisions/runpacks."
files = ["system-tests/tests/suites/transport_parity.rs"]
run_command = "cargo test -p system-tests --features system-tests --test mcp_transport -- --exact multi_transport_parity"
artifacts = [
  "summary.json",
  "summary.md",
  "tool_transcript.json",
  "http_manifest.json",
  "stdio_manifest.json",
  "cli_manifest.json",
  "runpack/",
  "mcp.stderr.log",
]
estimated_runtime_sec = 25

[[tests]]
name = "runpack_export_includes_security_context"
category = "runpack"
priority = "P2"
description = "Runpack manifests include security context metadata for exports."
files = ["system-tests/tests/suites/runpack.rs"]
run_command = "cargo test -p system-tests --features system-tests --test runpack -- --exact runpack_export_includes_security_context"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "runpack/"]
estimated_runtime_sec = 18

[[tests]]
name = "anchor_validation_fuzz_cases_fail_closed"
category = "security"
priority = "P2"
description = "Malformed/oversized anchors fail closed with explicit errors."
files = ["system-tests/tests/suites/anchor_fuzz.rs"]
run_command = "cargo test -p system-tests --features system-tests --test security -- --exact anchor_validation_fuzz_cases_fail_closed"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "runpack/"]
estimated_runtime_sec = 20

[[tests]]
name = "performance_smoke"
category = "performance"
priority = "P2"
description = "Non-gated MCP workflow throughput smoke test."
files = ["system-tests/tests/suites/performance.rs"]
run_command = "cargo test -p system-tests --features system-tests --test performance -- --ignored --exact performance_smoke"
artifacts = ["summary.json", "summary.md", "tool_transcript.json", "perf_metrics.json"]
estimated_runtime_sec = 25

[[tests]]
name = "stress_registry_concurrent_writes"
category = "reliability"
priority = "P2"
description = "Concurrent schema registry writes remain stable and ordered."
files = ["system-tests/tests/suites/stress.rs"]
run_command = "cargo test -p system-tests --features system-tests --test reliability -- --exact stress_registry_concurrent_writes"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 20

[[tests]]
name = "stress_schema_list_paging_concurrent_reads"
category = "reliability"
priority = "P2"
description = "Schemas list paging stays deterministic under concurrent reads."
files = ["system-tests/tests/suites/stress.rs"]
run_command = "cargo test -p system-tests --features system-tests --test reliability -- --exact stress_schema_list_paging_concurrent_reads"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 20

[[tests]]
name = "stress_precheck_request_storm"
category = "reliability"
priority = "P2"
description = "Precheck request storms fail closed and remain stable."
files = ["system-tests/tests/suites/stress.rs"]
run_command = "cargo test -p system-tests --features system-tests --test reliability -- --exact stress_precheck_request_storm"
artifacts = ["summary.json", "summary.md", "tool_transcript.json"]
estimated_runtime_sec = 25
